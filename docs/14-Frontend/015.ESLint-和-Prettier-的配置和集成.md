---
title: ESLint 和 Prettier 的配置和集成
tags:
  - 前端工程化
status: robot
class: 前端工程化
slug: eslint-prettier-configuration-integration
ref:
---

## 核心要点

**职责分离**: ESLint 负责代码质量(潜在错误、最佳实践),Prettier 负责代码风格(格式化)
**配置优先级**: 配置文件 → extends 继承 → rules 覆盖 → inline 注释
**集成方案**: 通过 eslint-config-prettier 禁用冲突规则,用 eslint-plugin-prettier 将 Prettier 作为 ESLint 规则运行
**编辑器集成**: VSCode 安装 ESLint、Prettier 插件,配置保存时自动修复

---

## 详细解答

### 一、ESLint 基础

#### 1. ESLint 简介

ESLint 是一个可配置的 JavaScript 代码检查工具,用于:
- **发现代码错误**: 未声明变量、未使用变量、死代码等
- **统一代码风格**: 强制团队遵循一致的编码规范
- **最佳实践**: 避免常见的反模式和坏味道

**核心特性**:
- 完全可插拔:所有规则都是插件,可自由启用/禁用
- 支持 JSX、TypeScript(通过插件)
- 可自动修复部分问题

#### 2. 安装和初始化

```bash
# 安装 ESLint
npm install eslint --save-dev

# 初始化配置文件(交互式向导)
npx eslint --init

# 或者手动安装常用配置
npm install --save-dev \
  eslint \
  @eslint/js \
  eslint-plugin-react \
  eslint-plugin-react-hooks \
  @typescript-eslint/parser \
  @typescript-eslint/eslint-plugin
```

#### 3. 配置文件

ESLint 支持多种配置文件格式(优先级从高到低):
- `.eslintrc.js` (推荐,可使用 JS 逻辑)
- `.eslintrc.cjs` (CommonJS 格式)
- `.eslintrc.yaml` / `.eslintrc.yml`
- `.eslintrc.json`
- `package.json` 中的 `eslintConfig` 字段

**基础配置示例**:

```javascript
// .eslintrc.js
module.exports = {
  // 运行环境
  env: {
    browser: true,      // 浏览器全局变量
    es2021: true,       // ES2021 全局变量
    node: true,         // Node.js 全局变量
  },

  // 继承共享配置
  extends: [
    'eslint:recommended',  // ESLint 推荐规则
    'plugin:react/recommended',
    'plugin:@typescript-eslint/recommended'
  ],

  // 解析器(TypeScript 需要)
  parser: '@typescript-eslint/parser',

  // 解析器选项
  parserOptions: {
    ecmaVersion: 'latest',  // 支持最新 ECMAScript 语法
    sourceType: 'module',   // 使用 ES 模块
    ecmaFeatures: {
      jsx: true             // 启用 JSX
    }
  },

  // 插件
  plugins: [
    'react',
    '@typescript-eslint'
  ],

  // 自定义规则
  rules: {
    'indent': ['error', 2],                    // 2 空格缩进
    'quotes': ['error', 'single'],             // 单引号
    'semi': ['error', 'always'],               // 必须使用分号
    'no-unused-vars': 'warn',                  // 未使用变量警告
    'no-console': 'off',                       // 允许 console
    '@typescript-eslint/no-explicit-any': 'off' // 允许 any 类型
  },

  // 忽略特定文件
  ignorePatterns: ['dist', 'node_modules', '*.config.js'],

  // 针对特定文件的配置
  overrides: [
    {
      files: ['*.ts', '*.tsx'],
      rules: {
        '@typescript-eslint/explicit-function-return-type': 'error'
      }
    }
  ]
};
```

#### 4. 规则配置

每条规则有三种级别:
- `"off"` 或 `0`: 关闭规则
- `"warn"` 或 `1`: 警告(不会导致退出码非 0)
- `"error"` 或 `2`: 错误(会导致退出码非 0)

```javascript
rules: {
  // 简单配置
  'no-console': 'off',

  // 带选项的配置
  'quotes': ['error', 'single'],              // 单引号
  'indent': ['error', 2, { 'SwitchCase': 1 }], // 2 空格,switch case 缩进

  // 复杂配置
  'max-len': ['error', {
    'code': 100,
    'ignoreComments': true,
    'ignoreUrls': true
  }]
}
```

**常用规则分类**:

```javascript
rules: {
  // 可能的错误
  'no-console': 'warn',                    // 禁止 console
  'no-debugger': 'error',                  // 禁止 debugger
  'no-dupe-keys': 'error',                 // 禁止对象字面量重复键
  'no-duplicate-case': 'error',            // 禁止 switch 重复 case

  // 最佳实践
  'eqeqeq': ['error', 'always'],           // 强制使用 ===
  'no-eval': 'error',                      // 禁止 eval
  'no-var': 'error',                       // 禁止 var,使用 let/const
  'prefer-const': 'warn',                  // 优先使用 const

  // 变量声明
  'no-unused-vars': ['warn', {             // 未使用变量
    'argsIgnorePattern': '^_',             // 忽略 _ 开头的参数
    'varsIgnorePattern': '^_'
  }],

  // 代码风格
  'indent': ['error', 2],                  // 缩进
  'quotes': ['error', 'single'],           // 引号
  'semi': ['error', 'always'],             // 分号
  'comma-dangle': ['error', 'always-multiline'], // 尾随逗号
  'object-curly-spacing': ['error', 'always'], // 对象括号空格

  // ES6
  'arrow-body-style': ['error', 'as-needed'], // 箭头函数体风格
  'prefer-arrow-callback': 'error',        // 优先使用箭头函数
  'prefer-template': 'error'               // 优先使用模板字符串
}
```

#### 5. 运行 ESLint

```bash
# 检查文件
npx eslint src/**/*.js

# 自动修复(仅修复可自动修复的问题)
npx eslint src/**/*.js --fix

# 检查并输出 JSON 格式
npx eslint src/**/*.js --format json

# package.json 脚本
{
  "scripts": {
    "lint": "eslint src --ext .js,.jsx,.ts,.tsx",
    "lint:fix": "eslint src --ext .js,.jsx,.ts,.tsx --fix"
  }
}
```

---

### 二、Prettier 基础

#### 1. Prettier 简介

Prettier 是一个固执己见的代码格式化工具,支持多种语言:
- JavaScript / TypeScript / JSX / TSX
- CSS / SCSS / Less
- HTML / Vue / Angular
- JSON / YAML / Markdown

**核心理念**:
- **无需配置**: 提供默认的最佳实践
- **统一风格**: 自动格式化,消除代码审查中的风格讨论
- **与 ESLint 职责分离**: ESLint 管质量,Prettier 管美观

#### 2. 安装

```bash
npm install --save-dev prettier
```

#### 3. 配置文件

Prettier 支持的配置文件(优先级从高到低):
- `.prettierrc`
- `.prettierrc.json`
- `.prettierrc.yaml` / `.prettierrc.yml`
- `.prettierrc.js` / `prettier.config.js`
- `package.json` 中的 `prettier` 字段

**配置示例**:

```javascript
// .prettierrc.js
module.exports = {
  // 每行最大字符数
  printWidth: 100,

  // 缩进空格数
  tabWidth: 2,

  // 使用空格而非 Tab
  useTabs: false,

  // 语句末尾添加分号
  semi: true,

  // 使用单引号
  singleQuote: true,

  // 对象属性引号:仅在需要时添加
  quoteProps: 'as-needed',

  // JSX 使用单引号
  jsxSingleQuote: false,

  // 多行时尾随逗号
  trailingComma: 'es5',

  // 对象字面量括号空格
  bracketSpacing: true,

  // JSX 标签闭合括号位置
  // true:  <div
  //          className="foo"
  //        >
  // false: <div
  //          className="foo">
  bracketSameLine: false,

  // 箭头函数参数括号
  // "always": (x) => x
  // "avoid":  x => x
  arrowParens: 'always',

  // 换行符
  // "lf": \n (Linux/Mac)
  // "crlf": \r\n (Windows)
  // "cr": \r
  // "auto": 保持现有
  endOfLine: 'lf',

  // Vue 文件中 <script> 和 <style> 标签缩进
  vueIndentScriptAndStyle: false
};
```

#### 4. 忽略文件

创建 `.prettierignore` 文件:

```
# 依赖
node_modules
package-lock.json

# 构建产物
dist
build
coverage

# 配置文件
*.config.js
.eslintrc.js

# 其他
*.min.js
*.bundle.js
```

#### 5. 运行 Prettier

```bash
# 格式化文件
npx prettier --write src/**/*.js

# 检查文件是否已格式化(不修改)
npx prettier --check src/**/*.js

# package.json 脚本
{
  "scripts": {
    "format": "prettier --write \"src/**/*.{js,jsx,ts,tsx,json,css,md}\"",
    "format:check": "prettier --check \"src/**/*.{js,jsx,ts,tsx,json,css,md}\""
  }
}
```

---

### 三、ESLint 和 Prettier 集成

#### 1. 冲突问题

ESLint 和 Prettier 在代码风格规则上可能冲突:

```javascript
// ESLint 规则: 要求单引号
"quotes": ["error", "single"]

// Prettier 配置: 使用双引号
{ "singleQuote": false }

// 结果: ESLint 报错,Prettier 格式化后又触发 ESLint 错误
```

#### 2. 解决方案:eslint-config-prettier

`eslint-config-prettier` 禁用所有与 Prettier 冲突的 ESLint 规则:

```bash
npm install --save-dev eslint-config-prettier
```

```javascript
// .eslintrc.js
module.exports = {
  extends: [
    'eslint:recommended',
    'plugin:react/recommended',
    'plugin:@typescript-eslint/recommended',
    'prettier'  // ⚠️ 必须放在最后,覆盖之前的规则
  ],
  rules: {
    // 自定义规则
  }
};
```

#### 3. 方案一:独立运行(推荐)

ESLint 和 Prettier 各自独立运行:

```json
// package.json
{
  "scripts": {
    "lint": "eslint src --ext .js,.jsx,.ts,.tsx",
    "lint:fix": "eslint src --ext .js,.jsx,.ts,.tsx --fix",
    "format": "prettier --write \"src/**/*.{js,jsx,ts,tsx,json,css,md}\"",
    "check": "npm run lint && npm run format:check",
    "format:check": "prettier --check \"src/**/*.{js,jsx,ts,tsx,json,css,md}\""
  }
}
```

**工作流程**:
1. 开发时:编辑器保存时自动运行 Prettier
2. 提交前:Git hook 运行 ESLint 和 Prettier
3. CI/CD:同时运行 `npm run lint` 和 `npm run format:check`

#### 4. 方案二:通过 ESLint 运行 Prettier

使用 `eslint-plugin-prettier` 将 Prettier 规则作为 ESLint 规则:

```bash
npm install --save-dev eslint-plugin-prettier eslint-config-prettier
```

```javascript
// .eslintrc.js
module.exports = {
  extends: [
    'eslint:recommended',
    'plugin:prettier/recommended'  // 包含 eslint-config-prettier 和 eslint-plugin-prettier
  ],
  rules: {
    'prettier/prettier': 'error'  // Prettier 问题显示为 ESLint 错误
  }
};
```

**优缺点**:
- ✅ 优点:一个命令同时检查质量和格式
- ❌ 缺点:Prettier 问题显示为 ESLint 错误,可能混淆
- ❌ 缺点:性能略慢(Prettier 通过 ESLint 运行)

---

### 四、TypeScript 项目配置

#### 1. 安装依赖

```bash
npm install --save-dev \
  eslint \
  @typescript-eslint/parser \
  @typescript-eslint/eslint-plugin \
  prettier \
  eslint-config-prettier
```

#### 2. ESLint 配置

```javascript
// .eslintrc.js
module.exports = {
  root: true,
  env: {
    browser: true,
    es2021: true,
    node: true
  },
  parser: '@typescript-eslint/parser',
  parserOptions: {
    ecmaVersion: 'latest',
    sourceType: 'module',
    project: './tsconfig.json'  // TypeScript 类型检查所需
  },
  extends: [
    'eslint:recommended',
    'plugin:@typescript-eslint/recommended',
    'plugin:@typescript-eslint/recommended-requiring-type-checking', // 需要类型信息的规则
    'prettier'
  ],
  plugins: ['@typescript-eslint'],
  rules: {
    // TypeScript 特定规则
    '@typescript-eslint/explicit-function-return-type': 'off',
    '@typescript-eslint/explicit-module-boundary-types': 'off',
    '@typescript-eslint/no-explicit-any': 'warn',
    '@typescript-eslint/no-unused-vars': ['warn', {
      'argsIgnorePattern': '^_',
      'varsIgnorePattern': '^_'
    }],
    '@typescript-eslint/naming-convention': [
      'error',
      {
        'selector': 'interface',
        'format': ['PascalCase'],
        'prefix': ['I']  // 接口以 I 开头
      },
      {
        'selector': 'typeAlias',
        'format': ['PascalCase']
      }
    ]
  },
  ignorePatterns: ['dist', 'node_modules', '*.config.js']
};
```

#### 3. Prettier 配置

```javascript
// .prettierrc.js
module.exports = {
  printWidth: 100,
  tabWidth: 2,
  useTabs: false,
  semi: true,
  singleQuote: true,
  quoteProps: 'as-needed',
  trailingComma: 'es5',
  bracketSpacing: true,
  arrowParens: 'always',
  endOfLine: 'lf'
};
```

---

### 五、React 项目配置

```bash
npm install --save-dev \
  eslint \
  eslint-plugin-react \
  eslint-plugin-react-hooks \
  @typescript-eslint/parser \
  @typescript-eslint/eslint-plugin \
  prettier \
  eslint-config-prettier
```

```javascript
// .eslintrc.js
module.exports = {
  root: true,
  env: {
    browser: true,
    es2021: true
  },
  parser: '@typescript-eslint/parser',
  parserOptions: {
    ecmaVersion: 'latest',
    sourceType: 'module',
    ecmaFeatures: {
      jsx: true
    }
  },
  extends: [
    'eslint:recommended',
    'plugin:react/recommended',
    'plugin:react/jsx-runtime',  // React 17+ 不需要 import React
    'plugin:react-hooks/recommended',
    'plugin:@typescript-eslint/recommended',
    'prettier'
  ],
  plugins: ['react', 'react-hooks', '@typescript-eslint'],
  settings: {
    react: {
      version: 'detect'  // 自动检测 React 版本
    }
  },
  rules: {
    // React 规则
    'react/prop-types': 'off',  // TypeScript 已提供类型检查
    'react/react-in-jsx-scope': 'off',  // React 17+ 不需要
    'react-hooks/rules-of-hooks': 'error',
    'react-hooks/exhaustive-deps': 'warn',

    // TypeScript 规则
    '@typescript-eslint/no-unused-vars': ['warn', {
      'argsIgnorePattern': '^_'
    }]
  }
};
```

---

### 六、编辑器集成(VSCode)

#### 1. 安装插件

- **ESLint**: `dbaeumer.vscode-eslint`
- **Prettier**: `esbenp.prettier-vscode`

#### 2. VSCode 配置

创建 `.vscode/settings.json`:

```json
{
  // 默认格式化工具
  "editor.defaultFormatter": "esbenp.prettier-vscode",

  // 保存时自动格式化
  "editor.formatOnSave": true,

  // 保存时自动修复 ESLint 错误
  "editor.codeActionsOnSave": {
    "source.fixAll.eslint": "explicit"
  },

  // ESLint 验证的文件类型
  "eslint.validate": [
    "javascript",
    "javascriptreact",
    "typescript",
    "typescriptreact"
  ],

  // Prettier 配置
  "prettier.requireConfig": true,  // 仅在项目有配置文件时启用

  // 针对特定语言的配置
  "[javascript]": {
    "editor.defaultFormatter": "esbenp.prettier-vscode"
  },
  "[typescript]": {
    "editor.defaultFormatter": "esbenp.prettier-vscode"
  },
  "[json]": {
    "editor.defaultFormatter": "esbenp.prettier-vscode"
  }
}
```

#### 3. 推荐扩展配置

创建 `.vscode/extensions.json`:

```json
{
  "recommendations": [
    "dbaeumer.vscode-eslint",
    "esbenp.prettier-vscode"
  ]
}
```

---

### 七、Git Hooks 集成

#### 1. 使用 husky 和 lint-staged

```bash
npm install --save-dev husky lint-staged

# 初始化 husky
npx husky init
```

#### 2. 配置

```json
// package.json
{
  "scripts": {
    "prepare": "husky install"
  },
  "lint-staged": {
    "*.{js,jsx,ts,tsx}": [
      "eslint --fix",
      "prettier --write"
    ],
    "*.{json,css,md}": [
      "prettier --write"
    ]
  }
}
```

创建 `.husky/pre-commit`:

```bash
#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

npx lint-staged
```

**工作流程**:
1. 开发者提交代码
2. Git pre-commit hook 触发
3. lint-staged 只处理暂存的文件
4. 依次运行 ESLint 修复和 Prettier 格式化
5. 如果有错误,提交失败

---

### 八、CI/CD 集成

#### 1. GitHub Actions 示例

```yaml
# .github/workflows/lint.yml
name: Lint

on:
  push:
    branches: [main, develop]
  pull_request:
    branches: [main, develop]

jobs:
  lint:
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v3

      - name: Setup Node.js
        uses: actions/setup-node@v3
        with:
          node-version: '18'
          cache: 'npm'

      - name: Install dependencies
        run: npm ci

      - name: Run ESLint
        run: npm run lint

      - name: Check Prettier formatting
        run: npm run format:check

      - name: Type check
        run: npm run type-check
```

#### 2. GitLab CI 示例

```yaml
# .gitlab-ci.yml
lint:
  stage: test
  image: node:18
  cache:
    paths:
      - node_modules/
  script:
    - npm ci
    - npm run lint
    - npm run format:check
  only:
    - merge_requests
    - main
```

---

### 九、常见问题和解决方案

#### 1. ESLint 和 Prettier 冲突

**症状**: Prettier 格式化后触发 ESLint 错误

**解决**:
```bash
npm install --save-dev eslint-config-prettier
```

```javascript
// .eslintrc.js
module.exports = {
  extends: [
    // ... 其他配置
    'prettier'  // 必须放在最后
  ]
};
```

#### 2. TypeScript 类型检查慢

**症状**: ESLint 运行很慢,尤其是有 `project: './tsconfig.json'` 时

**解决**:
- 为 ESLint 创建独立的 `tsconfig.eslint.json`,只包含需要检查的文件
- 使用 `ignorePatterns` 排除不需要检查的文件

```javascript
// .eslintrc.js
module.exports = {
  parserOptions: {
    project: './tsconfig.eslint.json'
  },
  ignorePatterns: ['dist', 'node_modules', '*.spec.ts']
};
```

```json
// tsconfig.eslint.json
{
  "extends": "./tsconfig.json",
  "include": ["src/**/*"],
  "exclude": ["node_modules", "dist"]
}
```

#### 3. 单个文件禁用规则

```javascript
// 整个文件禁用
/* eslint-disable */

// 禁用特定规则
/* eslint-disable no-console, @typescript-eslint/no-explicit-any */

// 下一行禁用
// eslint-disable-next-line no-console
console.log('debug');

// 当前行禁用
console.log('debug'); // eslint-disable-line no-console

// Prettier 忽略
// prettier-ignore
const matrix = [
  1, 0, 0,
  0, 1, 0,
  0, 0, 1
];
```

#### 4. 命令行覆盖配置

```bash
# 覆盖 ESLint 规则
npx eslint src --rule 'no-console: off'

# 覆盖 Prettier 配置
npx prettier --write src --single-quote --trailing-comma all
```

---

### 十、最佳实践

#### 1. 团队协作

- **提交配置文件**: `.eslintrc.js`、`.prettierrc.js` 提交到版本控制
- **统一编辑器配置**: 提交 `.vscode/settings.json`
- **文档化规则**: 在 README 中说明为什么启用/禁用某些规则

#### 2. 性能优化

```javascript
// .eslintrc.js
module.exports = {
  // 设置项目根目录,避免向上查找配置文件
  root: true,

  // 使用缓存加速
  cache: true,
  cacheLocation: 'node_modules/.cache/eslint',

  // 忽略不需要检查的文件
  ignorePatterns: ['dist', 'node_modules', 'coverage']
};
```

```json
// package.json
{
  "scripts": {
    "lint": "eslint src --cache --cache-location node_modules/.cache/eslint"
  }
}
```

#### 3. 渐进式迁移

如果项目已有大量代码不符合规范:

```javascript
// .eslintrc.js
module.exports = {
  rules: {
    // 先设为 warn,逐步修复后再改为 error
    'no-console': 'warn',
    '@typescript-eslint/no-explicit-any': 'warn'
  }
};
```

```bash
# 生成错误报告
npx eslint src --format json --output-file eslint-report.json

# 分批修复
npx eslint src/module1 --fix
npx eslint src/module2 --fix
```

---

### 总结

**ESLint vs Prettier 职责**:
| 工具 | 职责 | 示例 |
|------|------|------|
| **ESLint** | 代码质量、最佳实践 | 未使用变量、===vs==、禁止 eval |
| **Prettier** | 代码格式 | 缩进、引号、换行、括号位置 |

**推荐配置流程**:
1. 安装依赖:`eslint`、`prettier`、`eslint-config-prettier`
2. 配置 `.eslintrc.js` 和 `.prettierrc.js`
3. 配置编辑器:VSCode 安装插件并启用保存时自动修复
4. 配置 Git Hooks:使用 `husky` + `lint-staged` 在提交前检查
5. 配置 CI/CD:在 pipeline 中运行 `lint` 和 `format:check`

**核心原则**:
- **自动化**: 依赖工具而非人工审查风格问题
- **一致性**: 团队使用相同配置
- **渐进式**: 大型项目逐步引入规则
- **性能优先**: 使用缓存和增量检查
