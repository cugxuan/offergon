---
title: HTTP/1.1、HTTP/2、HTTP/3 的区别是什么？
tags:
  - 应用层协议
  - 计算机网络
status: robot
class: 计算机网络
slug: http1-http2-http3-differences
ref:
---

## 核心要点

**HTTP/1.1**：持久连接、管道化，但存在队头阻塞问题；
**HTTP/2**：二进制分帧、多路复用、头部压缩、服务器推送，解决应用层队头阻塞；
**HTTP/3**：基于 QUIC（UDP），彻底解决 TCP 队头阻塞，连接迁移，0-RTT 握手。

---

## HTTP/1.1

### 主要特性

#### 1. 持久连接（Keep-Alive）
- 默认开启 `Connection: keep-alive`
- 一个 TCP 连接可以发送多个 HTTP 请求/响应
- 减少 TCP 握手开销

#### 2. 管道化（Pipelining）
- 允许客户端在收到响应前发送多个请求
- **但实际很少使用**，因为存在队头阻塞问题

#### 3. 缓存控制
- `Cache-Control`、`ETag`、`Last-Modified` 等头部
- 支持条件请求（304 Not Modified）

### 主要问题

#### 1. 队头阻塞（Head-of-Line Blocking）
- HTTP 请求必须**按顺序**响应
- 前面的请求阻塞会影响后续所有请求
- 即使使用管道化也无法解决

#### 2. 头部冗余
- 每次请求都要发送完整的头部
- Cookie、User-Agent 等重复发送浪费带宽

#### 3. 资源利用率低
- 浏览器通常对每个域名限制 6-8 个并发连接
- 需要域名分片（Domain Sharding）来提升并发

## HTTP/2

### 主要特性

#### 1. 二进制分帧（Binary Framing）
- HTTP 消息被分解为独立的**帧**（Frame）
- 帧在**流**（Stream）中传输
- 同一连接可以并行传输多个流（多路复用）

#### 2. 多路复用（Multiplexing）
- **单个 TCP 连接**上可以并发传输多个请求/响应
- 请求之间互不影响，解决了 HTTP/1.1 的队头阻塞
- 不再需要域名分片

#### 3. 头部压缩（Header Compression - HPACK）
- 使用 **HPACK** 算法压缩头部
- 维护头部字段索引表，重复头部只发送索引
- 减少带宽消耗

#### 4. 服务器推送（Server Push）
- 服务器可以主动推送资源给客户端
- 客户端请求 HTML 时，服务器可以推送 CSS、JS 等资源
- 减少请求往返次数

#### 5. 流优先级（Stream Prioritization）
- 可以为不同流设置优先级和依赖关系
- 优先加载重要资源

### 仍存在的问题

#### TCP 层面的队头阻塞
- 虽然解决了应用层队头阻塞，但 **TCP 丢包重传**会阻塞整个连接
- 一个 TCP 包丢失会阻塞所有 HTTP/2 流

## HTTP/3

### 主要特性

#### 1. 基于 QUIC 协议（UDP）
- 不再使用 TCP，改用基于 **UDP** 的 QUIC 协议
- QUIC 在用户态实现可靠传输，不受操作系统 TCP 栈限制

#### 2. 解决 TCP 队头阻塞
- QUIC 在传输层实现**流级别的可靠性**
- 一个流丢包不会阻塞其他流
- 彻底解决队头阻塞问题

#### 3. 连接迁移（Connection Migration）
- 连接通过 **Connection ID** 标识，而非四元组（IP + 端口）
- 客户端 IP 变化（如切换 WiFi 到 4G）时连接不会断开
- 提升移动网络体验

#### 4. 0-RTT 连接建立
- 首次连接需要 1-RTT（QUIC + TLS 1.3 握手合并）
- 后续连接可以 **0-RTT** 恢复，直接发送应用数据
- 大幅降低延迟

#### 5. 改进的拥塞控制
- QUIC 内置拥塞控制，可以在用户态快速迭代优化
- 不受操作系统内核限制

#### 6. 内置加密（TLS 1.3）
- QUIC 强制使用 TLS 1.3 加密
- 握手和加密合并，减少往返次数

## 三者对比总结

| 特性 | HTTP/1.1 | HTTP/2 | HTTP/3 |
|------|----------|--------|--------|
| **传输层** | TCP | TCP | QUIC（UDP） |
| **多路复用** | ✗（管道化不实用） | ✓ | ✓ |
| **头部压缩** | ✗ | ✓（HPACK） | ✓（QPACK） |
| **服务器推送** | ✗ | ✓ | ✓ |
| **应用层队头阻塞** | 存在 | 解决 | 解决 |
| **传输层队头阻塞** | 存在（TCP） | 存在（TCP） | 解决（QUIC 流独立） |
| **连接迁移** | ✗ | ✗ | ✓ |
| **0-RTT 连接** | ✗ | ✗ | ✓ |
| **加密** | 可选（HTTPS） | 可选（实际强制） | 强制（TLS 1.3） |
| **消息格式** | 文本 | 二进制（帧） | 二进制（帧） |

## 实际应用场景

- **HTTP/1.1**：传统 Web 应用，简单场景
- **HTTP/2**：现代 Web 应用，广泛部署，性能大幅提升
- **HTTP/3**：高延迟或不稳定网络（移动网络），追求极致性能的应用

## 迁移建议

1. **HTTP/1.1 → HTTP/2**：主流浏览器和服务器都支持，升级成本低
2. **HTTP/2 → HTTP/3**：需要 QUIC 支持，部分 CDN 和浏览器已支持，逐步推广中
