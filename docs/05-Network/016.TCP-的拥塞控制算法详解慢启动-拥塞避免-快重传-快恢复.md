---
title: TCP 的拥塞控制算法详解（慢启动、拥塞避免、快重传、快恢复）
tags:
  - 网络协议
  - 计算机网络
status: robot
class: 计算机网络
slug: tcp-congestion-control-algorithms
ref:
---

## 要点提炼

TCP拥塞控制是网络传输性能的核心机制，通过动态调整发送窗口大小来防止网络过载。四大核心算法协同工作：**慢启动**实现指数级窗口增长探测网络容量，**拥塞避免**进行线性增长保持稳定，**快重传**通过重复ACK快速检测丢包，**快恢复**避免不必要的窗口重置，共同实现网络吞吐量最大化与拥塞预防的平衡。

## 详细回答

### 1. TCP拥塞控制概述

TCP拥塞控制是一套动态调整数据发送速率的机制，目的是防止发送方向网络中注入过多数据包导致网络拥塞。它通过维护拥塞窗口（cwnd）来控制未确认数据包的数量。

**核心原理：**
- 发送窗口 = min(拥塞窗口, 接收窗口)
- 动态调整拥塞窗口大小以适应网络状况
- 基于丢包和延迟反馈推断网络拥塞程度

### 2. 慢启动（Slow Start）

**工作原理：**
慢启动是TCP连接初期探测网络容量的机制，采用指数增长策略快速提升传输速率。

**算法流程：**
1. **初始化**：cwnd = 1 MSS（最大报文段长度）
2. **增长规则**：每收到一个ACK，cwnd += 1 MSS
3. **结果**：每个RTT周期，cwnd翻倍（指数增长）
4. **退出条件**：cwnd >= ssthresh（慢启动阈值）或发生丢包

```
RTT 1: cwnd = 1, 发送1个包
RTT 2: cwnd = 2, 发送2个包
RTT 3: cwnd = 4, 发送4个包
RTT 4: cwnd = 8, 发送8个包
...
```

**设计思想：**
- "慢"体现在初始值小，而非增长速度慢
- 快速探测网络可用带宽
- 避免连接建立时立即发送大量数据

### 3. 拥塞避免（Congestion Avoidance）

**工作原理：**
当cwnd达到ssthresh后，切换到线性增长模式，谨慎探测额外带宽。

**算法流程：**
1. **触发条件**：cwnd >= ssthresh
2. **增长规则**：每个RTT周期，cwnd += 1 MSS
3. **实现方式**：每收到一个ACK，cwnd += 1/cwnd
4. **持续时间**：直到检测到拥塞（丢包）

```
cwnd增长模式：
RTT n:   cwnd = N
RTT n+1: cwnd = N+1
RTT n+2: cwnd = N+2
...
```

**设计目标：**
- 保持网络接近但不超过容量极限
- 线性增长减少拥塞风险
- 持续但谨慎地探测可用带宽

### 4. 快重传（Fast Retransmit）

**工作原理：**
通过重复ACK快速检测丢包，无需等待超时定时器。

**算法流程：**
1. **检测机制**：接收方收到乱序数据包时发送重复ACK
2. **触发条件**：发送方收到3个重复ACK
3. **执行动作**：立即重传可能丢失的数据包
4. **避免超时**：显著减少重传延迟

```
正常情况：
发送: [1][2][3][4][5]
接收: ACK1 ACK2 ACK3 ACK4 ACK5

丢包情况：
发送: [1][2][X][4][5]  (包3丢失)
接收: ACK1 ACK2 ACK2 ACK2 ACK2  (重复ACK2)
检测: 收到3个重复ACK2，立即重传包3
```

**优势：**
- 快速丢包检测，典型情况下减少1个RTT延迟
- 避免超时重传的长时间等待
- 提高网络利用率

### 5. 快恢复（Fast Recovery）

**工作原理：**
在快重传后快速恢复拥塞窗口，避免不必要的慢启动。

**算法流程：**
1. **触发**：执行快重传后
2. **设置阈值**：ssthresh = cwnd / 2
3. **调整窗口**：cwnd = ssthresh + 3 MSS
4. **后续处理**：
   - 每收到重复ACK：cwnd += 1 MSS
   - 收到新ACK：cwnd = ssthresh，进入拥塞避免

```
快恢复过程：
1. 检测到3个重复ACK
2. ssthresh = cwnd / 2 = 16 / 2 = 8
3. cwnd = ssthresh + 3 = 8 + 3 = 11
4. 重传丢失包
5. 继续接收重复ACK，cwnd继续增加
6. 收到新ACK后，cwnd = ssthresh = 8
```

**设计理念：**
- 认为网络仍有一定容量（未完全拥塞）
- 避免cwnd降至1造成的性能下降
- 快速恢复到合理的传输速率

### 6. 算法状态转换

```
连接建立 → 慢启动
    ↓
cwnd >= ssthresh → 拥塞避免
    ↓
检测到3个重复ACK → 快重传 + 快恢复
    ↓
收到新ACK → 拥塞避免

超时事件 → ssthresh = cwnd/2, cwnd = 1 → 慢启动
```

### 7. 关键参数详解

**拥塞窗口（cwnd）：**
- 发送方维护的动态窗口
- 表示网络可承受的未确认数据量
- 单位：MSS（最大报文段长度）

**慢启动阈值（ssthresh）：**
- 区分慢启动和拥塞避免的临界值
- 初始值通常设为65535字节
- 发生拥塞时设为cwnd/2

**重复ACK计数：**
- 快重传的触发条件
- 标准值为3个重复ACK
- 平衡误检和及时检测

### 8. 性能影响分析

**吞吐量计算：**
```
平均吞吐量 ≈ 1.22 × MSS / (RTT × √p)
其中 p 为丢包率
```

**收敛时间：**
- 慢启动阶段：log₂(ssthresh) 个RTT
- 拥塞避免阶段：线性增长至最优值

**公平性：**
- 多个TCP流会收敛到公平共享带宽
- RTT较小的流获得更多带宽份额

### 9. 实际应用考虑

**现代改进：**
- **TCP Reno**：标准实现
- **TCP NewReno**：改进快恢复机制
- **TCP CUBIC**：高带宽网络优化
- **BBR算法**：基于带宽和RTT的控制

**调优参数：**
```bash
# Linux系统TCP参数调优
echo 'net.core.rmem_max = 16777216' >> /etc/sysctl.conf
echo 'net.core.wmem_max = 16777216' >> /etc/sysctl.conf
echo 'net.ipv4.tcp_congestion_control = cubic' >> /etc/sysctl.conf
```

TCP拥塞控制算法是现代互联网稳定运行的基石，理解其工作原理对于网络性能优化和问题排查具有重要意义。
