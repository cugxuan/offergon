---
title: React çš„æ€§èƒ½ä¼˜åŒ–ç­–ç•¥ï¼ˆä»£ç åˆ†å‰²ã€æ‡’åŠ è½½ã€è™šæ‹Ÿåˆ—è¡¨ï¼‰
tags:
  - å‰ç«¯React
status: robot
class: å‰ç«¯React
slug: react-performance-optimization-strategies
ref:
---

## æ ¸å¿ƒè¦ç‚¹

**React æ€§èƒ½ä¼˜åŒ–çš„æ ¸å¿ƒæ˜¯"é¿å…ä¸å¿…è¦çš„æ¸²æŸ“å’Œè®¡ç®—"ï¼Œé€šè¿‡ä»£ç åˆ†å‰²å‡å°‘åˆå§‹åŠ è½½ä½“ç§¯ï¼Œæ‡’åŠ è½½æŒ‰éœ€åŠ è½½èµ„æºï¼Œè™šæ‹Ÿåˆ—è¡¨åªæ¸²æŸ“å¯è§åŒºåŸŸï¼Œä»è€Œå®ç°æè‡´çš„ç”¨æˆ·ä½“éªŒã€‚**

å…³é”®æŠ€æœ¯ï¼š
- ğŸ“¦ **ä»£ç åˆ†å‰²**ï¼š`React.lazy` + Dynamic Import + Route-based Splitting
- â³ **æ‡’åŠ è½½**ï¼šå›¾ç‰‡æ‡’åŠ è½½ã€ç»„ä»¶æ‡’åŠ è½½ã€é¢„åŠ è½½ç­–ç•¥
- ğŸš€ **è™šæ‹Ÿåˆ—è¡¨**ï¼šreact-window / react-virtualizedï¼Œåªæ¸²æŸ“å¯è§é¡¹
- âš¡ **å…¶ä»–ä¼˜åŒ–**ï¼šmemoã€useMemoã€useCallbackã€Web Worker

---

## è¯¦ç»†è§£ç­”

### ä¸€ã€ä»£ç åˆ†å‰²ï¼ˆCode Splittingï¼‰

#### 1. ä¸ºä»€ä¹ˆéœ€è¦ä»£ç åˆ†å‰²

**é—®é¢˜**ï¼šå•é¡µåº”ç”¨æ‰“åŒ…æˆä¸€ä¸ªå·¨å¤§çš„ bundle.js

```javascript
// æœªä¼˜åŒ–å‰
// bundle.js (2.5MB)
â”œâ”€â”€ react, react-dom (150KB)
â”œâ”€â”€ ä¸»é¡µç»„ä»¶ (50KB)
â”œâ”€â”€ ç®¡ç†åå° (800KB)     âŒ æ™®é€šç”¨æˆ·æ°¸è¿œä¸ä¼šè®¿é—®
â”œâ”€â”€ æ•°æ®åˆ†æé¡µé¢ (500KB)  âŒ å¤§éƒ¨åˆ†ç”¨æˆ·ä¸ä½¿ç”¨
â”œâ”€â”€ ç¬¬ä¸‰æ–¹åº“ (1MB)
â””â”€â”€ ...

// ç»“æœï¼š
// - é¦–æ¬¡åŠ è½½æ—¶é—´ï¼š5-10ç§’
// - ç”¨æˆ·æµå¤±ç‡ï¼š+40%
```

**è§£å†³æ–¹æ¡ˆ**ï¼šæŒ‰éœ€åŠ è½½

```javascript
// ä¼˜åŒ–å
// main.js (200KB) - ç«‹å³åŠ è½½
// home.chunk.js (50KB) - è®¿é—®é¦–é¡µæ—¶åŠ è½½
// admin.chunk.js (800KB) - è®¿é—®ç®¡ç†åå°æ—¶åŠ è½½
// analytics.chunk.js (500KB) - æ‰“å¼€æ•°æ®åˆ†ææ—¶åŠ è½½

// ç»“æœï¼š
// - é¦–æ¬¡åŠ è½½æ—¶é—´ï¼š1-2ç§’ âœ…
// - é¦–å±åŠ è½½æå‡ï¼š5x
```

#### 2. React.lazy + Suspense

**2.1 åŸºæœ¬ç”¨æ³•**

```javascript
import { lazy, Suspense } from 'react'

// âŒ ä¼ ç»Ÿå¯¼å…¥ï¼ˆæ‰“åŒ…åˆ°ä¸» bundleï¼‰
// import Dashboard from './Dashboard'

// âœ… æ‡’åŠ è½½ï¼ˆç‹¬ç«‹ chunkï¼‰
const Dashboard = lazy(() => import('./Dashboard'))
const Analytics = lazy(() => import('./Analytics'))
const Settings = lazy(() => import('./Settings'))

function App() {
  return (
    <div>
      <Suspense fallback={<Loading />}>
        <Dashboard />
      </Suspense>
    </div>
  )
}

// Loading ç»„ä»¶
function Loading() {
  return (
    <div className="loading-skeleton">
      <div className="skeleton-header" />
      <div className="skeleton-content" />
    </div>
  )
}
```

**2.2 é”™è¯¯å¤„ç†**

```javascript
import { lazy, Suspense, Component } from 'react'

// Error Boundary
class ErrorBoundary extends Component {
  state = { hasError: false, error: null }

  static getDerivedStateFromError(error) {
    return { hasError: true, error }
  }

  componentDidCatch(error, errorInfo) {
    console.error('Lazy load failed:', error, errorInfo)
    // å‘é€åˆ°é”™è¯¯ç›‘æ§æœåŠ¡
    Sentry.captureException(error)
  }

  render() {
    if (this.state.hasError) {
      return (
        <div>
          <h2>ç»„ä»¶åŠ è½½å¤±è´¥</h2>
          <button onClick={() => window.location.reload()}>
            åˆ·æ–°é¡µé¢
          </button>
        </div>
      )
    }

    return this.props.children
  }
}

// ä½¿ç”¨
function App() {
  return (
    <ErrorBoundary>
      <Suspense fallback={<Loading />}>
        <LazyComponent />
      </Suspense>
    </ErrorBoundary>
  )
}
```

**2.3 å¸¦é‡è¯•æœºåˆ¶çš„æ‡’åŠ è½½**

```javascript
// lazyWithRetry.js
function lazyWithRetry(componentImport, retries = 3) {
  return lazy(() => {
    return new Promise((resolve, reject) => {
      const attemptImport = (retriesLeft) => {
        componentImport()
          .then(resolve)
          .catch((error) => {
            if (retriesLeft === 0) {
              reject(error)
            } else {
              console.log(`Retrying import... (${retriesLeft} attempts left)`)
              setTimeout(() => attemptImport(retriesLeft - 1), 1000)
            }
          })
      }

      attemptImport(retries)
    })
  })
}

// ä½¿ç”¨
const Dashboard = lazyWithRetry(() => import('./Dashboard'))
```

#### 3. è·¯ç”±çº§ä»£ç åˆ†å‰²ï¼ˆæœ€ä½³å®è·µï¼‰

```javascript
import { lazy, Suspense } from 'react'
import { BrowserRouter, Routes, Route } from 'react-router-dom'

// è·¯ç”±ç»„ä»¶æ‡’åŠ è½½
const Home = lazy(() => import('./pages/Home'))
const Products = lazy(() => import('./pages/Products'))
const ProductDetail = lazy(() => import('./pages/ProductDetail'))
const Admin = lazy(() => import('./pages/Admin'))

function App() {
  return (
    <BrowserRouter>
      <Suspense fallback={<PageLoading />}>
        <Routes>
          <Route path="/" element={<Home />} />
          <Route path="/products" element={<Products />} />
          <Route path="/products/:id" element={<ProductDetail />} />
          <Route path="/admin" element={<Admin />} />
        </Routes>
      </Suspense>
    </BrowserRouter>
  )
}

// é¡µé¢çº§ Loading
function PageLoading() {
  return (
    <div className="page-loading">
      <div className="spinner" />
      <p>åŠ è½½ä¸­...</p>
    </div>
  )
}
```

#### 4. ç»„ä»¶çº§ä»£ç åˆ†å‰²

```javascript
// é‡å‹ç»„ä»¶æ‡’åŠ è½½
const HeavyChart = lazy(() => import('./HeavyChart'))
const RichTextEditor = lazy(() => import('./RichTextEditor'))
const VideoPlayer = lazy(() => import('./VideoPlayer'))

function Dashboard() {
  const [showChart, setShowChart] = useState(false)

  return (
    <div>
      <h1>Dashboard</h1>
      <button onClick={() => setShowChart(true)}>æ˜¾ç¤ºå›¾è¡¨</button>

      {showChart && (
        <Suspense fallback={<Skeleton />}>
          <HeavyChart data={data} />
        </Suspense>
      )}
    </div>
  )
}
```

#### 5. åŠ¨æ€å¯¼å…¥ï¼ˆAdvancedï¼‰

```javascript
// æ ¹æ®æ¡ä»¶åŠ¨æ€åŠ è½½ä¸åŒç»„ä»¶
function ThemeProvider({ theme, children }) {
  const [ThemeComponent, setThemeComponent] = useState(null)

  useEffect(() => {
    const loadTheme = async () => {
      if (theme === 'dark') {
        const module = await import('./themes/DarkTheme')
        setThemeComponent(() => module.default)
      } else {
        const module = await import('./themes/LightTheme')
        setThemeComponent(() => module.default)
      }
    }

    loadTheme()
  }, [theme])

  if (!ThemeComponent) return <Loading />

  return <ThemeComponent>{children}</ThemeComponent>
}

// åŠ¨æ€åŠ è½½è¯­è¨€åŒ…
async function loadLocale(locale) {
  const messages = await import(`./locales/${locale}.json`)
  return messages.default
}

// åŠ¨æ€åŠ è½½å·¥å…·åº“
async function loadAnalytics() {
  if (process.env.NODE_ENV === 'production') {
    const analytics = await import('analytics')
    analytics.init()
  }
}
```

---

### äºŒã€æ‡’åŠ è½½ï¼ˆLazy Loadingï¼‰

#### 1. å›¾ç‰‡æ‡’åŠ è½½

**1.1 åŸç”Ÿ Intersection Observer**

```javascript
function LazyImage({ src, alt, placeholder }) {
  const [imageSrc, setImageSrc] = useState(placeholder)
  const [isLoaded, setIsLoaded] = useState(false)
  const imgRef = useRef(null)

  useEffect(() => {
    const observer = new IntersectionObserver(
      (entries) => {
        entries.forEach((entry) => {
          if (entry.isIntersecting) {
            setImageSrc(src)
            observer.unobserve(entry.target)
          }
        })
      },
      {
        rootMargin: '50px' // æå‰ 50px åŠ è½½
      }
    )

    if (imgRef.current) {
      observer.observe(imgRef.current)
    }

    return () => {
      if (imgRef.current) {
        observer.unobserve(imgRef.current)
      }
    }
  }, [src])

  return (
    <img
      ref={imgRef}
      src={imageSrc}
      alt={alt}
      onLoad={() => setIsLoaded(true)}
      className={isLoaded ? 'loaded' : 'loading'}
    />
  )
}

// ä½¿ç”¨
<LazyImage
  src="/images/high-res.jpg"
  placeholder="/images/placeholder.jpg"
  alt="Product"
/>
```

**1.2 ç°ä»£æµè§ˆå™¨åŸç”Ÿæ”¯æŒ**

```javascript
// HTML loading å±æ€§ï¼ˆæœ€ç®€å•ï¼ï¼‰
<img src="/image.jpg" loading="lazy" alt="Product" />

// React ä¸­
function ProductImage({ src, alt }) {
  return (
    <img
      src={src}
      alt={alt}
      loading="lazy" // æµè§ˆå™¨åŸç”Ÿæ‡’åŠ è½½
      decoding="async" // å¼‚æ­¥è§£ç 
    />
  )
}
```

**1.3 æ¸è¿›å¼å›¾ç‰‡åŠ è½½ï¼ˆLQIP - Low Quality Image Placeholderï¼‰**

```javascript
function ProgressiveImage({ lowQualitySrc, highQualitySrc, alt }) {
  const [src, setSrc] = useState(lowQualitySrc)
  const [isLoading, setIsLoading] = useState(true)

  useEffect(() => {
    const img = new Image()
    img.src = highQualitySrc

    img.onload = () => {
      setSrc(highQualitySrc)
      setIsLoading(false)
    }
  }, [highQualitySrc])

  return (
    <div className={`progressive-image ${isLoading ? 'loading' : 'loaded'}`}>
      <img src={src} alt={alt} />
    </div>
  )
}

// CSS
// .progressive-image.loading img {
//   filter: blur(10px);
// }
// .progressive-image.loaded img {
//   filter: none;
//   transition: filter 0.3s ease;
// }
```

#### 2. ç»„ä»¶é¢„åŠ è½½

**2.1 é¼ æ ‡æ‚¬åœé¢„åŠ è½½**

```javascript
function PreloadableLink({ to, children }) {
  const [isPreloaded, setIsPreloaded] = useState(false)

  const preload = () => {
    if (!isPreloaded) {
      // é¢„åŠ è½½è·¯ç”±ç»„ä»¶
      import(`./pages${to}`)
      setIsPreloaded(true)
    }
  }

  return (
    <Link
      to={to}
      onMouseEnter={preload}  // é¼ æ ‡æ‚¬åœæ—¶é¢„åŠ è½½
      onFocus={preload}        // é”®ç›˜èšç„¦æ—¶é¢„åŠ è½½
    >
      {children}
    </Link>
  )
}
```

**2.2 å¯è§æ—¶é¢„åŠ è½½**

```javascript
function PreloadWhenVisible({ children, preloadFunc }) {
  const ref = useRef(null)
  const [hasPreloaded, setHasPreloaded] = useState(false)

  useEffect(() => {
    const observer = new IntersectionObserver(
      (entries) => {
        if (entries[0].isIntersecting && !hasPreloaded) {
          preloadFunc()
          setHasPreloaded(true)
          observer.disconnect()
        }
      },
      { rootMargin: '100px' }
    )

    if (ref.current) {
      observer.observe(ref.current)
    }

    return () => observer.disconnect()
  }, [preloadFunc, hasPreloaded])

  return <div ref={ref}>{children}</div>
}

// ä½¿ç”¨
<PreloadWhenVisible preloadFunc={() => import('./HeavyComponent')}>
  <button>ç‚¹å‡»æŸ¥çœ‹è¯¦æƒ…</button>
</PreloadWhenVisible>
```

**2.3 ç©ºé—²æ—¶é¢„åŠ è½½**

```javascript
// ä½¿ç”¨ requestIdleCallback
function preloadOnIdle(importFunc) {
  if ('requestIdleCallback' in window) {
    requestIdleCallback(() => {
      importFunc()
    })
  } else {
    // é™çº§æ–¹æ¡ˆ
    setTimeout(importFunc, 1)
  }
}

// ä½¿ç”¨
function App() {
  useEffect(() => {
    // é¦–å±æ¸²æŸ“å®Œæˆåï¼Œç©ºé—²æ—¶é¢„åŠ è½½å…¶ä»–è·¯ç”±
    preloadOnIdle(() => import('./pages/Dashboard'))
    preloadOnIdle(() => import('./pages/Settings'))
  }, [])

  return <div>...</div>
}
```

---

### ä¸‰ã€è™šæ‹Ÿåˆ—è¡¨ï¼ˆVirtual List / Windowingï¼‰

#### 1. ä¸ºä»€ä¹ˆéœ€è¦è™šæ‹Ÿåˆ—è¡¨

```javascript
// âŒ ç›´æ¥æ¸²æŸ“ 10000 é¡¹
function BadList({ items }) {
  return (
    <div>
      {items.map(item => (
        <div key={item.id} className="list-item">
          {item.name}
        </div>
      ))}
    </div>
  )
}
// é—®é¢˜ï¼š
// - 10000 ä¸ª DOM èŠ‚ç‚¹ï¼ˆå†…å­˜å ç”¨ ~100MBï¼‰
// - é¦–æ¬¡æ¸²æŸ“è€—æ—¶ 2-5 ç§’
// - æ»šåŠ¨å¡é¡¿ï¼ˆéœ€è¦ layout 10000 ä¸ªå…ƒç´ ï¼‰

// âœ… è™šæ‹Ÿåˆ—è¡¨ï¼šåªæ¸²æŸ“å¯è§çš„ 20 é¡¹
// - 20 ä¸ª DOM èŠ‚ç‚¹ï¼ˆå†…å­˜å ç”¨ ~2MBï¼‰
// - é¦–æ¬¡æ¸²æŸ“è€—æ—¶ <100ms
// - æ»šåŠ¨æµç•…ï¼ˆ60fpsï¼‰
```

#### 2. æ‰‹å†™ç®€å•è™šæ‹Ÿåˆ—è¡¨

```javascript
function VirtualList({ items, itemHeight, containerHeight }) {
  const [scrollTop, setScrollTop] = useState(0)

  // å¯è§åŒºåŸŸçš„èµ·æ­¢ç´¢å¼•
  const startIndex = Math.floor(scrollTop / itemHeight)
  const endIndex = Math.ceil((scrollTop + containerHeight) / itemHeight)

  // å¯è§é¡¹
  const visibleItems = items.slice(startIndex, endIndex + 1)

  // æ€»é«˜åº¦
  const totalHeight = items.length * itemHeight

  // åç§»é‡
  const offsetY = startIndex * itemHeight

  return (
    <div
      style={{ height: containerHeight, overflow: 'auto' }}
      onScroll={(e) => setScrollTop(e.target.scrollTop)}
    >
      <div style={{ height: totalHeight, position: 'relative' }}>
        <div style={{ transform: `translateY(${offsetY}px)` }}>
          {visibleItems.map((item, index) => (
            <div
              key={startIndex + index}
              style={{ height: itemHeight }}
              className="list-item"
            >
              {item.name}
            </div>
          ))}
        </div>
      </div>
    </div>
  )
}

// ä½¿ç”¨
const items = Array.from({ length: 10000 }, (_, i) => ({
  id: i,
  name: `Item ${i}`
}))

<VirtualList
  items={items}
  itemHeight={50}
  containerHeight={600}
/>
```

#### 3. react-windowï¼ˆæ¨èï¼‰

**3.1 å›ºå®šé«˜åº¦åˆ—è¡¨**

```javascript
import { FixedSizeList } from 'react-window'

function MyList({ items }) {
  const Row = ({ index, style }) => (
    <div style={style} className="list-item">
      {items[index].name}
    </div>
  )

  return (
    <FixedSizeList
      height={600}        // å®¹å™¨é«˜åº¦
      itemCount={items.length}
      itemSize={50}       // æ¯é¡¹é«˜åº¦
      width="100%"
    >
      {Row}
    </FixedSizeList>
  )
}
```

**3.2 åŠ¨æ€é«˜åº¦åˆ—è¡¨**

```javascript
import { VariableSizeList } from 'react-window'

function DynamicList({ items }) {
  const listRef = useRef(null)
  const rowHeights = useRef({})

  // è®¾ç½®è¡Œé«˜
  const setRowHeight = (index, size) => {
    listRef.current.resetAfterIndex(0)
    rowHeights.current = { ...rowHeights.current, [index]: size }
  }

  // è·å–è¡Œé«˜
  const getRowHeight = (index) => {
    return rowHeights.current[index] || 80 // é»˜è®¤é«˜åº¦
  }

  const Row = ({ index, style }) => {
    const rowRef = useRef(null)

    useEffect(() => {
      if (rowRef.current) {
        setRowHeight(index, rowRef.current.clientHeight)
      }
    }, [index])

    return (
      <div style={style}>
        <div ref={rowRef} className="dynamic-row">
          <h3>{items[index].title}</h3>
          <p>{items[index].content}</p>
        </div>
      </div>
    )
  }

  return (
    <VariableSizeList
      ref={listRef}
      height={600}
      itemCount={items.length}
      itemSize={getRowHeight}
      width="100%"
    >
      {Row}
    </VariableSizeList>
  )
}
```

**3.3 è™šæ‹Ÿç½‘æ ¼**

```javascript
import { FixedSizeGrid } from 'react-window'

function ImageGrid({ images }) {
  const Cell = ({ columnIndex, rowIndex, style }) => {
    const index = rowIndex * 5 + columnIndex // 5 åˆ—
    const image = images[index]

    if (!image) return null

    return (
      <div style={style} className="grid-cell">
        <img src={image.url} alt={image.title} loading="lazy" />
      </div>
    )
  }

  return (
    <FixedSizeGrid
      columnCount={5}
      columnWidth={200}
      height={600}
      rowCount={Math.ceil(images.length / 5)}
      rowHeight={200}
      width={1000}
    >
      {Cell}
    </FixedSizeGrid>
  )
}
```

**3.4 æ— é™æ»šåŠ¨ + è™šæ‹Ÿåˆ—è¡¨**

```javascript
import { FixedSizeList } from 'react-window'
import InfiniteLoader from 'react-window-infinite-loader'

function InfiniteVirtualList() {
  const [items, setItems] = useState([])
  const [hasNextPage, setHasNextPage] = useState(true)

  // åŠ è½½æ›´å¤š
  const loadMoreItems = async (startIndex, stopIndex) => {
    const newItems = await fetchItems(startIndex, stopIndex)
    setItems(prev => [...prev, ...newItems])

    if (newItems.length === 0) {
      setHasNextPage(false)
    }
  }

  // æ£€æŸ¥æ˜¯å¦å·²åŠ è½½
  const isItemLoaded = (index) => !hasNextPage || index < items.length

  const Row = ({ index, style }) => {
    const item = items[index]

    if (!item) {
      return <div style={style}>åŠ è½½ä¸­...</div>
    }

    return (
      <div style={style}>
        {item.name}
      </div>
    )
  }

  return (
    <InfiniteLoader
      isItemLoaded={isItemLoaded}
      itemCount={hasNextPage ? items.length + 1 : items.length}
      loadMoreItems={loadMoreItems}
    >
      {({ onItemsRendered, ref }) => (
        <FixedSizeList
          height={600}
          itemCount={hasNextPage ? items.length + 1 : items.length}
          itemSize={50}
          onItemsRendered={onItemsRendered}
          ref={ref}
          width="100%"
        >
          {Row}
        </FixedSizeList>
      )}
    </InfiniteLoader>
  )
}
```

---

### å››ã€å…¶ä»–æ€§èƒ½ä¼˜åŒ–æŠ€å·§

#### 1. React.memo é¿å…é‡æ¸²æŸ“

```javascript
// âŒ çˆ¶ç»„ä»¶æ›´æ–°æ—¶ï¼Œå­ç»„ä»¶æ€»æ˜¯é‡æ¸²æŸ“
function BadChild({ name }) {
  console.log('Rendering Child')
  return <div>{name}</div>
}

// âœ… ä½¿ç”¨ memoï¼Œprops ä¸å˜æ—¶è·³è¿‡æ¸²æŸ“
const GoodChild = memo(function Child({ name }) {
  console.log('Rendering Child')
  return <div>{name}</div>
})

// è‡ªå®šä¹‰æ¯”è¾ƒå‡½æ•°
const OptimizedChild = memo(
  function Child({ user }) {
    return <div>{user.name}</div>
  },
  (prevProps, nextProps) => {
    // è¿”å› true è¡¨ç¤ºè·³è¿‡æ›´æ–°
    return prevProps.user.id === nextProps.user.id
  }
)
```

#### 2. useMemo ç¼“å­˜è®¡ç®—ç»“æœ

```javascript
function ExpensiveComponent({ items, filterText }) {
  // âŒ æ¯æ¬¡æ¸²æŸ“éƒ½é‡æ–°è®¡ç®—
  // const filtered = items.filter(item => item.name.includes(filterText))

  // âœ… åªåœ¨ä¾èµ–é¡¹å˜åŒ–æ—¶é‡æ–°è®¡ç®—
  const filtered = useMemo(() => {
    console.log('Filtering...')
    return items.filter(item => item.name.includes(filterText))
  }, [items, filterText])

  return <ul>{filtered.map(item => <li key={item.id}>{item.name}</li>)}</ul>
}
```

#### 3. useCallback ç¼“å­˜å‡½æ•°å¼•ç”¨

```javascript
function Parent() {
  const [count, setCount] = useState(0)

  // âŒ æ¯æ¬¡æ¸²æŸ“éƒ½åˆ›å»ºæ–°å‡½æ•°ï¼Œå¯¼è‡´ Child é‡æ¸²æŸ“
  // const handleClick = () => console.log('Clicked')

  // âœ… ä½¿ç”¨ useCallback ç¼“å­˜å‡½æ•°
  const handleClick = useCallback(() => {
    console.log('Clicked')
  }, [])

  return (
    <div>
      <button onClick={() => setCount(count + 1)}>Count: {count}</button>
      <Child onClick={handleClick} />
    </div>
  )
}

const Child = memo(({ onClick }) => {
  console.log('Rendering Child')
  return <button onClick={onClick}>Click me</button>
})
```

#### 4. Web Worker å¤„ç†é‡å‹è®¡ç®—

```javascript
// worker.js
self.addEventListener('message', (e) => {
  const { data, type } = e.data

  if (type === 'SORT') {
    const sorted = data.sort((a, b) => b - a) // è€—æ—¶æ’åº
    self.postMessage({ type: 'SORT_COMPLETE', data: sorted })
  }
})

// Component.jsx
function HeavyComputation({ numbers }) {
  const [sorted, setSorted] = useState([])

  useEffect(() => {
    const worker = new Worker(new URL('./worker.js', import.meta.url))

    worker.postMessage({ type: 'SORT', data: numbers })

    worker.onmessage = (e) => {
      if (e.data.type === 'SORT_COMPLETE') {
        setSorted(e.data.data)
      }
    }

    return () => worker.terminate()
  }, [numbers])

  return <ul>{sorted.map(n => <li key={n}>{n}</li>)}</ul>
}
```

#### 5. æ—¶é—´åˆ‡ç‰‡ï¼ˆTime Slicingï¼‰

```javascript
// ä½¿ç”¨ React 18 çš„ startTransition
import { useState, startTransition } from 'react'

function SearchPage() {
  const [input, setInput] = useState('')
  const [results, setResults] = useState([])

  const handleChange = (e) => {
    // ç«‹å³æ›´æ–°è¾“å…¥æ¡†ï¼ˆé«˜ä¼˜å…ˆçº§ï¼‰
    setInput(e.target.value)

    // å»¶è¿Ÿæ›´æ–°æœç´¢ç»“æœï¼ˆä½ä¼˜å…ˆçº§ï¼‰
    startTransition(() => {
      const filtered = hugeData.filter(item =>
        item.name.includes(e.target.value)
      )
      setResults(filtered)
    })
  }

  return (
    <div>
      <input value={input} onChange={handleChange} />
      <ul>
        {results.map(item => <li key={item.id}>{item.name}</li>)}
      </ul>
    </div>
  )
}
```

---

### äº”ã€æ€§èƒ½ç›‘æ§ä¸åˆ†æ

#### 1. React DevTools Profiler

```javascript
import { Profiler } from 'react'

function onRenderCallback(
  id,        // ç»„ä»¶ ID
  phase,     // "mount" æˆ– "update"
  actualDuration, // æœ¬æ¬¡æ¸²æŸ“è€—æ—¶
  baseDuration,   // é¢„ä¼°æ¸²æŸ“è€—æ—¶
  startTime,
  commitTime
) {
  console.log(`${id} ${phase} took ${actualDuration}ms`)
}

function App() {
  return (
    <Profiler id="App" onRender={onRenderCallback}>
      <Dashboard />
    </Profiler>
  )
}
```

#### 2. Lighthouse æ€§èƒ½å®¡è®¡

```bash
# Chrome DevTools â†’ Lighthouse â†’ Generate Report
# å…³é”®æŒ‡æ ‡ï¼š
# - FCP (First Contentful Paint) < 1.8s
# - LCP (Largest Contentful Paint) < 2.5s
# - TTI (Time to Interactive) < 3.8s
# - TBT (Total Blocking Time) < 200ms
# - CLS (Cumulative Layout Shift) < 0.1
```

---

## æ€»ç»“

### ä¼˜åŒ–ç­–ç•¥å¯¹æ¯”

| æŠ€æœ¯ | é€‚ç”¨åœºæ™¯ | æ€§èƒ½æå‡ | å®ç°å¤æ‚åº¦ |
|------|---------|---------|-----------|
| **ä»£ç åˆ†å‰²** | å¤§å‹åº”ç”¨ã€å¤šè·¯ç”± | â­â­â­â­â­ | ç®€å• |
| **æ‡’åŠ è½½** | å›¾ç‰‡å¯†é›†ã€é‡å‹ç»„ä»¶ | â­â­â­â­ | ç®€å• |
| **è™šæ‹Ÿåˆ—è¡¨** | é•¿åˆ—è¡¨ï¼ˆ>1000é¡¹ï¼‰ | â­â­â­â­â­ | ä¸­ç­‰ |
| **memo/useMemo** | é¢‘ç¹é‡æ¸²æŸ“çš„ç»„ä»¶ | â­â­â­ | ç®€å• |
| **Web Worker** | CPU å¯†é›†å‹è®¡ç®— | â­â­â­â­ | ä¸­ç­‰ |

### æœ€ä½³å®è·µæ£€æŸ¥æ¸…å•

âœ… **åˆå§‹åŠ è½½ä¼˜åŒ–**
- [ ] è·¯ç”±çº§ä»£ç åˆ†å‰²
- [ ] ç¬¬ä¸‰æ–¹åº“æŒ‰éœ€å¼•å…¥ï¼ˆtree-shakingï¼‰
- [ ] å‹ç¼©æ‰“åŒ…ä½“ç§¯ï¼ˆGzip/Brotliï¼‰

âœ… **è¿è¡Œæ—¶ä¼˜åŒ–**
- [ ] é•¿åˆ—è¡¨ä½¿ç”¨è™šæ‹Ÿæ»šåŠ¨
- [ ] å›¾ç‰‡æ‡’åŠ è½½ + WebP æ ¼å¼
- [ ] ç»„ä»¶æ‡’åŠ è½½ + é¢„åŠ è½½

âœ… **æ¸²æŸ“ä¼˜åŒ–**
- [ ] React.memo é¿å…ä¸å¿…è¦çš„é‡æ¸²æŸ“
- [ ] useMemo/useCallback ç¼“å­˜è®¡ç®—å’Œå‡½æ•°
- [ ] ä½¿ç”¨ key ä¼˜åŒ–åˆ—è¡¨æ¸²æŸ“

âœ… **ç›‘æ§ä¸è°ƒè¯•**
- [ ] React DevTools Profiler åˆ†ææ€§èƒ½ç“¶é¢ˆ
- [ ] Lighthouse å®šæœŸå®¡è®¡
- [ ] çœŸå®ç”¨æˆ·ç›‘æ§ï¼ˆRUMï¼‰

æŒæ¡è¿™äº›æ€§èƒ½ä¼˜åŒ–æŠ€æœ¯ï¼Œå¯ä»¥è®© React åº”ç”¨åœ¨ä»»ä½•è®¾å¤‡ä¸Šéƒ½ä¿æŒæµç•…ï¼Œæ˜¾è‘—æå‡ç”¨æˆ·ä½“éªŒå’Œä¸šåŠ¡è½¬åŒ–ç‡ã€‚
