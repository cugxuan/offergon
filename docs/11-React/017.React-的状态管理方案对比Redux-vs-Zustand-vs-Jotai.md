---
title: React çš„çŠ¶æ€ç®¡ç†æ–¹æ¡ˆå¯¹æ¯”ï¼ˆRedux vs Zustand vs Jotaiï¼‰
tags:
  - React
status: robot
class: å‰ç«¯React
slug: react-state-management-redux-vs-zustand-vs-jotai
ref:
---

## æ ¸å¿ƒè¦ç‚¹

**React çŠ¶æ€ç®¡ç†æ–¹æ¡ˆç»å†äº†ä» Redux å•ä¸€å·¨çŸ³åˆ° Zustand/Jotai ç­‰è½»é‡åŒ–ã€åŸå­åŒ–çš„æ¼”è¿›ï¼Œé€‰æ‹©æ—¶éœ€æƒè¡¡é¡¹ç›®è§„æ¨¡ã€å›¢é˜Ÿç†Ÿæ‚‰åº¦ã€æ€§èƒ½éœ€æ±‚å’Œå¼€å‘ä½“éªŒã€‚**

å¿«é€Ÿå¯¹æ¯”ï¼š
- ğŸ›ï¸ **Redux**: é›†ä¸­å¼ã€å¯é¢„æµ‹ã€å·¥å…·é“¾å®Œå–„ï¼Œé€‚åˆå¤§å‹åº”ç”¨å’Œå¤æ‚ä¸šåŠ¡é€»è¾‘
- ğŸª¶ **Zustand**: æç®€ APIã€åŸºäº Hooksã€æ— æ ·æ¿ä»£ç ï¼Œé€‚åˆä¸­å°å‹é¡¹ç›®
- âš›ï¸ **Jotai**: åŸå­åŒ–çŠ¶æ€ã€ç»†ç²’åº¦æ›´æ–°ã€React 18 ä¼˜å…ˆï¼Œé€‚åˆæ€§èƒ½æ•æ„Ÿåœºæ™¯

---

## è¯¦ç»†è§£ç­”

### ä¸€ã€Reduxï¼šè€ç‰Œé›†ä¸­å¼çŠ¶æ€ç®¡ç†

#### 1. æ ¸å¿ƒæ¦‚å¿µ

Redux éµå¾ª **Flux æ¶æ„**ï¼Œé‡‡ç”¨å•å‘æ•°æ®æµå’Œé›†ä¸­å¼ Storeã€‚

```
Action â†’ Dispatch â†’ Reducer â†’ Store â†’ View
          â†‘                              â†“
          â””â”€â”€â”€â”€â”€â”€â”€â”€ User Interaction â”€â”€â”€â”€â”˜
```

#### 2. åŸºæœ¬ç”¨æ³•

```javascript
// ========== ä¼ ç»Ÿ Redux ==========
// store.js
import { createStore } from 'redux'

const initialState = {
  count: 0,
  user: null
}

function rootReducer(state = initialState, action) {
  switch (action.type) {
    case 'INCREMENT':
      return { ...state, count: state.count + 1 }
    case 'SET_USER':
      return { ...state, user: action.payload }
    default:
      return state
  }
}

const store = createStore(rootReducer)

// actions.js
export const increment = () => ({ type: 'INCREMENT' })
export const setUser = (user) => ({ type: 'SET_USER', payload: user })

// Component.jsx
import { useDispatch, useSelector } from 'react-redux'
import { increment } from './actions'

function Counter() {
  const count = useSelector(state => state.count)
  const dispatch = useDispatch()

  return (
    <div>
      <p>Count: {count}</p>
      <button onClick={() => dispatch(increment())}>+1</button>
    </div>
  )
}
```

#### 3. Redux Toolkit (ç°ä»£æœ€ä½³å®è·µ)

```javascript
// ========== Redux Toolkit (RTK) ==========
// counterSlice.js
import { createSlice, createAsyncThunk } from '@reduxjs/toolkit'

// å¼‚æ­¥ thunk
export const fetchUser = createAsyncThunk(
  'user/fetch',
  async (userId) => {
    const response = await fetch(`/api/users/${userId}`)
    return response.json()
  }
)

const counterSlice = createSlice({
  name: 'counter',
  initialState: {
    count: 0,
    user: null,
    status: 'idle'
  },
  reducers: {
    increment: (state) => {
      // ä½¿ç”¨ Immerï¼Œå¯ç›´æ¥ä¿®æ”¹ state
      state.count += 1
    },
    decrement: (state) => {
      state.count -= 1
    },
    incrementByAmount: (state, action) => {
      state.count += action.payload
    }
  },
  extraReducers: (builder) => {
    builder
      .addCase(fetchUser.pending, (state) => {
        state.status = 'loading'
      })
      .addCase(fetchUser.fulfilled, (state, action) => {
        state.status = 'succeeded'
        state.user = action.payload
      })
      .addCase(fetchUser.rejected, (state) => {
        state.status = 'failed'
      })
  }
})

export const { increment, decrement, incrementByAmount } = counterSlice.actions
export default counterSlice.reducer

// store.js
import { configureStore } from '@reduxjs/toolkit'
import counterReducer from './counterSlice'

export const store = configureStore({
  reducer: {
    counter: counterReducer
  }
})

// Component.jsx
import { useDispatch, useSelector } from 'react-redux'
import { increment, fetchUser } from './counterSlice'

function App() {
  const { count, user, status } = useSelector(state => state.counter)
  const dispatch = useDispatch()

  useEffect(() => {
    dispatch(fetchUser(123))
  }, [])

  return (
    <div>
      <p>Count: {count}</p>
      <button onClick={() => dispatch(increment())}>+1</button>
      {status === 'loading' && <p>Loading user...</p>}
      {user && <p>User: {user.name}</p>}
    </div>
  )
}
```

#### 4. Redux ä¼˜åŠ¿

âœ… **å¼ºå¤§çš„å¼€å‘å·¥å…·**
- Redux DevToolsï¼šæ—¶é—´æ—…è¡Œè°ƒè¯•ã€çŠ¶æ€å¿«ç…§ã€åŠ¨ä½œå›æ”¾
- å®Œæ•´çš„çŠ¶æ€å†å²è®°å½•

âœ… **å¯é¢„æµ‹æ€§**
- çº¯å‡½æ•° Reducerï¼Œç›¸åŒè¾“å…¥å¿…ç„¶å¾—åˆ°ç›¸åŒè¾“å‡º
- ä¸¥æ ¼çš„å•å‘æ•°æ®æµ

âœ… **ç”Ÿæ€ç³»ç»Ÿæˆç†Ÿ**
- redux-saga / redux-thunk / RTK Queryï¼ˆå¼‚æ­¥å¤„ç†ï¼‰
- redux-persistï¼ˆçŠ¶æ€æŒä¹…åŒ–ï¼‰
- reselectï¼ˆè®°å¿†åŒ–é€‰æ‹©å™¨ï¼‰

âœ… **é€‚åˆå¤§å‹åº”ç”¨**
- ä¸¥æ ¼çš„ä»£ç ç»„ç»‡è§„èŒƒ
- æ˜“äºå›¢é˜Ÿåä½œå’Œä»£ç å®¡æŸ¥

#### 5. Redux åŠ£åŠ¿

âŒ **æ ·æ¿ä»£ç å¤š**ï¼ˆå³ä½¿ä½¿ç”¨ RTK ä¹Ÿéœ€è¦è¾ƒå¤šé…ç½®ï¼‰
âŒ **å­¦ä¹ æ›²çº¿é™¡å³­**ï¼ˆActionã€Reducerã€Middlewareã€Selector ç­‰æ¦‚å¿µï¼‰
âŒ **æ€§èƒ½å¼€é”€**ï¼ˆæ‰€æœ‰ selector åœ¨æ¯æ¬¡ dispatch åéƒ½ä¼šé‡æ–°æ‰§è¡Œï¼‰
âŒ **è¿‡åº¦å·¥ç¨‹åŒ–**ï¼ˆå°å‹é¡¹ç›®ä½¿ç”¨ Redux å¯èƒ½æ€é¸¡ç”¨ç‰›åˆ€ï¼‰

---

### äºŒã€Zustandï¼šæç®€ä¸»ä¹‰çš„ Hook-First æ–¹æ¡ˆ

#### 1. æ ¸å¿ƒç†å¿µ

Zustand (å¾·è¯­"çŠ¶æ€") é‡‡ç”¨ **Hook-First** è®¾è®¡ï¼ŒæŠ›å¼ƒ Redux çš„æ ·æ¿ä»£ç ï¼Œç›´æ¥ä½¿ç”¨å‡½æ•°å¼ APIã€‚

#### 2. åŸºæœ¬ç”¨æ³•

```javascript
// ========== Zustand ==========
// store.js
import { create } from 'zustand'

const useStore = create((set, get) => ({
  // çŠ¶æ€
  count: 0,
  user: null,
  todos: [],

  // åŒæ­¥ actions
  increment: () => set((state) => ({ count: state.count + 1 })),
  decrement: () => set((state) => ({ count: state.count - 1 })),

  // å¼‚æ­¥ actions
  fetchUser: async (userId) => {
    const response = await fetch(`/api/users/${userId}`)
    const user = await response.json()
    set({ user })
  },

  // å¤æ‚é€»è¾‘ï¼ˆå¯è®¿é—®å½“å‰çŠ¶æ€ï¼‰
  addTodo: (text) => {
    const newTodo = { id: Date.now(), text, done: false }
    set((state) => ({ todos: [...state.todos, newTodo] }))
  },

  toggleTodo: (id) => {
    set((state) => ({
      todos: state.todos.map(todo =>
        todo.id === id ? { ...todo, done: !todo.done } : todo
      )
    }))
  },

  // ä½¿ç”¨ get() è®¿é—®å…¶ä»–çŠ¶æ€
  getActiveTodos: () => {
    return get().todos.filter(todo => !todo.done)
  }
}))

export default useStore

// Component.jsx
import useStore from './store'

function Counter() {
  // é€‰æ‹©éœ€è¦çš„çŠ¶æ€ï¼ˆè‡ªåŠ¨è®¢é˜…ï¼‰
  const count = useStore(state => state.count)
  const increment = useStore(state => state.increment)

  return (
    <div>
      <p>Count: {count}</p>
      <button onClick={increment}>+1</button>
    </div>
  )
}

function UserProfile() {
  const user = useStore(state => state.user)
  const fetchUser = useStore(state => state.fetchUser)

  useEffect(() => {
    fetchUser(123)
  }, [])

  return user ? <p>{user.name}</p> : <p>Loading...</p>
}
```

#### 3. é«˜çº§ç‰¹æ€§

**3.1 ä¸­é—´ä»¶ï¼ˆMiddlewareï¼‰**

```javascript
import { create } from 'zustand'
import { devtools, persist } from 'zustand/middleware'

const useStore = create(
  devtools(
    persist(
      (set) => ({
        count: 0,
        increment: () => set((state) => ({ count: state.count + 1 }))
      }),
      {
        name: 'counter-storage', // localStorage key
        partialize: (state) => ({ count: state.count }) // åªæŒä¹…åŒ–éƒ¨åˆ†çŠ¶æ€
      }
    )
  )
)
```

**3.2 åˆ‡ç‰‡æ¨¡å¼ï¼ˆSlice Patternï¼‰**

```javascript
// userSlice.js
const createUserSlice = (set) => ({
  user: null,
  setUser: (user) => set({ user }),
  clearUser: () => set({ user: null })
})

// counterSlice.js
const createCounterSlice = (set) => ({
  count: 0,
  increment: () => set((state) => ({ count: state.count + 1 }))
})

// store.js
const useStore = create((...a) => ({
  ...createUserSlice(...a),
  ...createCounterSlice(...a)
}))
```

**3.3 é€‰æ‹©å™¨ä¼˜åŒ–**

```javascript
import { shallow } from 'zustand/shallow'

// âŒ é—®é¢˜ï¼šæ¯æ¬¡ store æ›´æ–°éƒ½ä¼šé‡æ–°æ¸²æŸ“
function BadComponent() {
  const { count, user } = useStore(state => ({
    count: state.count,
    user: state.user
  }))
  // æ¯æ¬¡éƒ½ä¼šåˆ›å»ºæ–°å¯¹è±¡ï¼Œå¯¼è‡´é‡æ–°æ¸²æŸ“
}

// âœ… æ–¹æ¡ˆ 1ï¼šä½¿ç”¨ shallow æ¯”è¾ƒ
function GoodComponent() {
  const { count, user } = useStore(
    state => ({ count: state.count, user: state.user }),
    shallow
  )
}

// âœ… æ–¹æ¡ˆ 2ï¼šåˆ†åˆ«è®¢é˜…
function BetterComponent() {
  const count = useStore(state => state.count)
  const user = useStore(state => state.user)
}
```

#### 4. Zustand ä¼˜åŠ¿

âœ… **æç®€ API**ï¼ˆå•ä¸ª `create` å‡½æ•°æå®šæ‰€æœ‰ï¼‰
âœ… **é›¶æ ·æ¿ä»£ç **ï¼ˆæ— éœ€ Providerã€Actionsã€Reducersï¼‰
âœ… **ä½“ç§¯å°**ï¼ˆå‹ç¼©åä»… 1.2KBï¼‰
âœ… **TypeScript å‹å¥½**ï¼ˆå®Œæ•´ç±»å‹æ¨å¯¼ï¼‰
âœ… **å¯åœ¨ React å¤–ä½¿ç”¨**ï¼ˆåŸç”Ÿ JS ä¹Ÿèƒ½ç”¨ï¼‰
âœ… **æ€§èƒ½ä¼˜ç§€**ï¼ˆåŸºäºè®¢é˜…æœºåˆ¶ï¼Œç²¾å‡†æ›´æ–°ï¼‰

#### 5. Zustand åŠ£åŠ¿

âŒ **ç¼ºå°‘ä¸¥æ ¼çº¦æŸ**ï¼ˆè‡ªç”±åº¦é«˜å¯èƒ½å¯¼è‡´ä»£ç æ··ä¹±ï¼‰
âŒ **DevTools åŠŸèƒ½è¾ƒå¼±**ï¼ˆç›¸æ¯” Redux DevToolsï¼‰
âŒ **ä¸­é—´ä»¶ç”Ÿæ€è¾ƒå°**

---

### ä¸‰ã€Jotaiï¼šåŸå­åŒ–çŠ¶æ€çš„æœªæ¥

#### 1. æ ¸å¿ƒç†å¿µ

Jotai (æ—¥è¯­"çŠ¶æ€") å— Recoil å¯å‘ï¼Œé‡‡ç”¨ **åŸå­åŒ– (Atomic)** è®¾è®¡ï¼Œæ¯ä¸ªçŠ¶æ€æ˜¯ç‹¬ç«‹çš„åŸå­ (atom)ï¼Œç»„ä»¶åªè®¢é˜…éœ€è¦çš„åŸå­ã€‚

```
ä¼ ç»Ÿæ¨¡å¼ï¼šStore â†’ Selector â†’ Componentï¼ˆç²—ç²’åº¦ï¼‰
Jotaiï¼š  Atom â†’ Componentï¼ˆç»†ç²’åº¦ï¼‰
```

#### 2. åŸºæœ¬ç”¨æ³•

```javascript
// ========== Jotai ==========
// atoms.js
import { atom } from 'jotai'

// åŸå§‹åŸå­
export const countAtom = atom(0)
export const userAtom = atom(null)

// æ´¾ç”ŸåŸå­ï¼ˆç±»ä¼¼è®¡ç®—å±æ€§ï¼‰
export const doubleCountAtom = atom(
  (get) => get(countAtom) * 2
)

// å¯å†™æ´¾ç”ŸåŸå­
export const incrementAtom = atom(
  (get) => get(countAtom),
  (get, set) => set(countAtom, get(countAtom) + 1)
)

// å¼‚æ­¥åŸå­
export const userDataAtom = atom(async (get) => {
  const userId = get(userIdAtom)
  const response = await fetch(`/api/users/${userId}`)
  return response.json()
})

// Component.jsx
import { useAtom, useAtomValue, useSetAtom } from 'jotai'
import { countAtom, doubleCountAtom, incrementAtom } from './atoms'

function Counter() {
  // useAtomï¼šè¯» + å†™
  const [count, setCount] = useAtom(countAtom)

  // useAtomValueï¼šåªè¯»
  const doubleCount = useAtomValue(doubleCountAtom)

  // useSetAtomï¼šåªå†™ï¼ˆæ€§èƒ½ä¼˜åŒ–ï¼Œä¸ä¼šå› è¯»å€¼å˜åŒ–è€Œé‡æ¸²æŸ“ï¼‰
  const increment = useSetAtom(incrementAtom)

  return (
    <div>
      <p>Count: {count}</p>
      <p>Double: {doubleCount}</p>
      <button onClick={() => setCount(c => c + 1)}>+1</button>
      <button onClick={increment}>Increment Atom</button>
    </div>
  )
}
```

#### 3. é«˜çº§ç‰¹æ€§

**3.1 åŸå­ä¾èµ–å…³ç³»**

```javascript
import { atom } from 'jotai'

// ä¾èµ–é“¾ï¼šA â†’ B â†’ C
const userIdAtom = atom(1)

const userAtom = atom(async (get) => {
  const userId = get(userIdAtom) // ä¾èµ– userIdAtom
  const res = await fetch(`/api/users/${userId}`)
  return res.json()
})

const userNameAtom = atom((get) => {
  const user = get(userAtom) // ä¾èµ– userAtom
  return user?.name ?? 'Anonymous'
})

// å½“ userIdAtom å˜åŒ–æ—¶ï¼ŒuserAtom å’Œ userNameAtom ä¼šè‡ªåŠ¨é‡æ–°è®¡ç®—
```

**3.2 åŸå­å®¶æ— (Atom Families)**

```javascript
import { atomFamily } from 'jotai/utils'

// åŠ¨æ€åˆ›å»ºåŸå­ï¼ˆç±»ä¼¼ React Query çš„ keyï¼‰
const todoAtomFamily = atomFamily((id) =>
  atom(async () => {
    const res = await fetch(`/api/todos/${id}`)
    return res.json()
  })
)

function TodoItem({ id }) {
  const todo = useAtomValue(todoAtomFamily(id))
  return <div>{todo.title}</div>
}
```

**3.3 æŒä¹…åŒ–**

```javascript
import { atomWithStorage } from 'jotai/utils'

// è‡ªåŠ¨åŒæ­¥åˆ° localStorage
const darkModeAtom = atomWithStorage('darkMode', false)

function ThemeToggle() {
  const [darkMode, setDarkMode] = useAtom(darkModeAtom)
  return (
    <button onClick={() => setDarkMode(!darkMode)}>
      {darkMode ? 'ğŸŒ™' : 'â˜€ï¸'}
    </button>
  )
}
```

**3.4 å¼‚æ­¥æ“ä½œä¸ Suspense**

```javascript
import { Suspense } from 'react'
import { atom, useAtomValue } from 'jotai'

const postsAtom = atom(async () => {
  const res = await fetch('/api/posts')
  return res.json()
})

function Posts() {
  const posts = useAtomValue(postsAtom) // å¼‚æ­¥åŸå­è‡ªåŠ¨è§¦å‘ Suspense
  return (
    <ul>
      {posts.map(post => <li key={post.id}>{post.title}</li>)}
    </ul>
  )
}

function App() {
  return (
    <Suspense fallback={<div>Loading...</div>}>
      <Posts />
    </Suspense>
  )
}
```

#### 4. Jotai ä¼˜åŠ¿

âœ… **ç»†ç²’åº¦æ›´æ–°**ï¼ˆåªæ›´æ–°ä½¿ç”¨è¯¥åŸå­çš„ç»„ä»¶ï¼Œæ€§èƒ½æä½³ï¼‰
âœ… **å¤©ç„¶æ”¯æŒ Suspense å’Œ Concurrent Mode**
âœ… **TypeScript æè‡´ä½“éªŒ**ï¼ˆå®Œç¾ç±»å‹æ¨å¯¼ï¼‰
âœ… **æ— éœ€ Provider**ï¼ˆå¯é€‰çš„ Provider ç”¨äºä½œç”¨åŸŸéš”ç¦»ï¼‰
âœ… **è°ƒè¯•å‹å¥½**ï¼ˆæ¯ä¸ªåŸå­å¯å•ç‹¬è¿½è¸ªï¼‰
âœ… **é€‚åˆå¤æ‚ä¾èµ–å…³ç³»**ï¼ˆåŸå­é—´ä¾èµ–è‡ªåŠ¨ç®¡ç†ï¼‰

#### 5. Jotai åŠ£åŠ¿

âŒ **å­¦ä¹ æ–°æ¦‚å¿µ**ï¼ˆåŸå­åŒ–æ€ç»´éœ€è¦é€‚åº”ï¼‰
âŒ **åŸå­ç¢ç‰‡åŒ–**ï¼ˆåŸå­è¿‡å¤šæ—¶ç®¡ç†å¤æ‚ï¼‰
âŒ **ç”Ÿæ€è¾ƒæ–°**ï¼ˆæ–‡æ¡£å’Œç¤¾åŒºç›¸å¯¹è¾ƒå°ï¼‰

---

### å››ã€ç»¼åˆå¯¹æ¯”è¡¨

| ç»´åº¦ | Redux (RTK) | Zustand | Jotai |
|------|------------|---------|-------|
| **Bundle å¤§å°** | ~15KB (RTK) | 1.2KB | 2.9KB |
| **å­¦ä¹ æ›²çº¿** | é™¡å³­ | å¹³ç¼“ | ä¸­ç­‰ |
| **æ ·æ¿ä»£ç ** | ä¸­ç­‰ï¼ˆRTK å·²ç®€åŒ–ï¼‰ | æå°‘ | å°‘ |
| **TypeScript** | è‰¯å¥½ï¼ˆéœ€æ‰‹åŠ¨å®šä¹‰ï¼‰ | ä¼˜ç§€ï¼ˆè‡ªåŠ¨æ¨å¯¼ï¼‰ | æè‡´ï¼ˆå®Œç¾æ¨å¯¼ï¼‰ |
| **DevTools** | å¼ºå¤§ï¼ˆRedux DevToolsï¼‰ | åŸºç¡€ï¼ˆéœ€ä¸­é—´ä»¶ï¼‰ | åŸºç¡€ï¼ˆå®˜æ–¹å·¥å…·ï¼‰ |
| **æ€§èƒ½** | è‰¯å¥½ï¼ˆselector ä¼˜åŒ–ï¼‰ | ä¼˜ç§€ï¼ˆè®¢é˜…æœºåˆ¶ï¼‰ | æè‡´ï¼ˆåŸå­åŒ–æ›´æ–°ï¼‰ |
| **å¼‚æ­¥å¤„ç†** | RTK Query / Thunk / Saga | å†…ç½® async/await | åŸç”Ÿ async atom + Suspense |
| **ä¸­é—´ä»¶** | ä¸°å¯Œ | æœ‰ï¼ˆå®˜æ–¹ + ç¤¾åŒºï¼‰ | æœ‰é™ |
| **æŒä¹…åŒ–** | redux-persist | zustand/middleware | jotai/utils |
| **React å¤–ä½¿ç”¨** | å¯ä»¥ï¼ˆéœ€é…ç½®ï¼‰ | åŸç”Ÿæ”¯æŒ | ä¸æ”¯æŒ |
| **é€‚ç”¨åœºæ™¯** | å¤§å‹åº”ç”¨ã€å¤æ‚ä¸šåŠ¡ | ä¸­å°å‹é¡¹ç›® | æ€§èƒ½æ•æ„Ÿã€React 18+ |

---

### äº”ã€å®æˆ˜é€‰æ‹©æŒ‡å—

#### åœºæ™¯ 1ï¼šå¤§å‹ä¼ä¸šçº§åº”ç”¨ï¼ˆç”µå•†ã€åå°ç®¡ç†ï¼‰

**æ¨è Redux Toolkit**

```javascript
// å¤æ‚çš„ä¸šåŠ¡é€»è¾‘å’Œä¸­é—´ä»¶
import { configureStore } from '@reduxjs/toolkit'
import { api } from './services/api' // RTK Query

const store = configureStore({
  reducer: {
    auth: authReducer,
    products: productsReducer,
    cart: cartReducer,
    orders: ordersReducer,
    [api.reducerPath]: api.reducer
  },
  middleware: (getDefaultMiddleware) =>
    getDefaultMiddleware().concat(
      api.middleware,
      loggerMiddleware,
      analyticsMiddleware
    )
})
```

**ç†ç”±**ï¼š
- ä¸¥æ ¼çš„ä»£ç è§„èŒƒä¾¿äºå›¢é˜Ÿåä½œ
- Redux DevTools å¼ºå¤§çš„è°ƒè¯•èƒ½åŠ›
- æˆç†Ÿçš„å¼‚æ­¥æ–¹æ¡ˆï¼ˆRTK Query æ›¿ä»£ React Queryï¼‰
- å®Œå–„çš„ç”Ÿæ€ç³»ç»Ÿ

#### åœºæ™¯ 2ï¼šä¸­å°å‹åˆ›ä¸šé¡¹ç›®ï¼ˆå¿«é€Ÿè¿­ä»£ï¼‰

**æ¨è Zustand**

```javascript
// å¿«é€Ÿå¼€å‘ï¼Œæ— éœ€å¤æ‚é…ç½®
const useAppStore = create((set, get) => ({
  user: null,
  theme: 'light',
  notifications: [],

  login: async (credentials) => {
    const user = await authApi.login(credentials)
    set({ user })
  },

  toggleTheme: () => set(state => ({
    theme: state.theme === 'light' ? 'dark' : 'light'
  })),

  addNotification: (message) => set(state => ({
    notifications: [...state.notifications, { id: Date.now(), message }]
  }))
}))
```

**ç†ç”±**ï¼š
- å¼€å‘é€Ÿåº¦å¿«ï¼Œä»£ç é‡å°‘
- æ˜“äºé‡æ„å’Œè°ƒæ•´
- å­¦ä¹ æˆæœ¬ä½ï¼Œæ–°æˆå‘˜å¿«é€Ÿä¸Šæ‰‹
- æ€§èƒ½è¶³å¤Ÿå¥½

#### åœºæ™¯ 3ï¼šé«˜æ€§èƒ½ Dashboardï¼ˆå¤§é‡æ•°æ®å¯è§†åŒ–ï¼‰

**æ¨è Jotai**

```javascript
// ç»†ç²’åº¦çŠ¶æ€ç®¡ç†ï¼Œé¿å…ä¸å¿…è¦çš„é‡æ¸²æŸ“
import { atom } from 'jotai'
import { atomFamily } from 'jotai/utils'

// æ¯ä¸ªå›¾è¡¨æ˜¯ç‹¬ç«‹çš„åŸå­
const chartDataFamily = atomFamily((chartId) =>
  atom(async () => {
    const res = await fetch(`/api/charts/${chartId}`)
    return res.json()
  })
)

const selectedChartIdAtom = atom('chart1')
const selectedChartDataAtom = atom((get) =>
  get(chartDataFamily(get(selectedChartIdAtom)))
)

// åªæœ‰ä½¿ç”¨è¯¥å›¾è¡¨æ•°æ®çš„ç»„ä»¶ä¼šæ›´æ–°
function Chart({ id }) {
  const data = useAtomValue(chartDataFamily(id))
  return <HeavyChart data={data} />
}
```

**ç†ç”±**ï¼š
- åŸå­åŒ–æ›´æ–°é¿å…å…¨å±€é‡æ¸²æŸ“
- å¤©ç„¶æ”¯æŒ Suspenseï¼Œä¼˜åŒ–åŠ è½½ä½“éªŒ
- ä¾èµ–è¿½è¸ªè‡ªåŠ¨åŒ–

#### åœºæ™¯ 4ï¼šæœåŠ¡ç«¯æ¸²æŸ“ (SSR) åº”ç”¨

**æ¨è Redux æˆ– Zustand**

```javascript
// Redux SSR
// server.js
const store = createStore(rootReducer)
const initialState = store.getState()
const html = renderToString(<App store={store} />)
// å°† initialState æ³¨å…¥ HTML

// client.js
const preloadedState = window.__INITIAL_STATE__
const store = createStore(rootReducer, preloadedState)
```

**ç†ç”±**ï¼š
- Redux å’Œ Zustand å¯¹ SSR æ”¯æŒæ›´æˆç†Ÿ
- Jotai çš„ SSR æ”¯æŒç›¸å¯¹å¤æ‚ï¼ˆéœ€è¦ç‰¹æ®Šå¤„ç†ï¼‰

---

### å…­ã€è¿ç§»ç­–ç•¥

#### ä» Redux è¿ç§»åˆ° Zustand

```javascript
// Redux ä»£ç 
const counterSlice = createSlice({
  name: 'counter',
  initialState: { value: 0 },
  reducers: {
    increment: (state) => { state.value += 1 },
    decrement: (state) => { state.value -= 1 }
  }
})

// Zustand ç­‰æ•ˆä»£ç 
const useCounterStore = create((set) => ({
  value: 0,
  increment: () => set(state => ({ value: state.value + 1 })),
  decrement: () => set(state => ({ value: state.value - 1 }))
}))

// ç»„ä»¶è¿ç§»
// Before (Redux)
const value = useSelector(state => state.counter.value)
const dispatch = useDispatch()
dispatch(increment())

// After (Zustand)
const value = useCounterStore(state => state.value)
const increment = useCounterStore(state => state.increment)
increment()
```

#### æ··åˆä½¿ç”¨ç­–ç•¥

```javascript
// æ¸è¿›å¼è¿ç§»ï¼šRedux ä¸»çŠ¶æ€ + Zustand å±€éƒ¨çŠ¶æ€
// Redux: å…¨å±€ç”¨æˆ·çŠ¶æ€ã€è·¯ç”±çŠ¶æ€
const store = configureStore({ reducer: { auth: authReducer } })

// Zustand: é¡µé¢çº§ä¸´æ—¶çŠ¶æ€
const usePageStore = create((set) => ({
  filter: 'all',
  setFilter: (filter) => set({ filter })
}))

function App() {
  return (
    <Provider store={store}>
      <Routes>
        <Route path="/products" element={<ProductsPage />} />
      </Routes>
    </Provider>
  )
}

function ProductsPage() {
  const user = useSelector(state => state.auth.user) // Redux
  const filter = usePageStore(state => state.filter) // Zustand
  // ...
}
```

---

### ä¸ƒã€æœ€ä½³å®è·µæ€»ç»“

#### Redux æœ€ä½³å®è·µ
1. âœ… ä½¿ç”¨ Redux Toolkitï¼Œé¿å…æ‰‹å†™ action types
2. âœ… ç”¨ RTK Query æ›¿ä»£æ‰‹åŠ¨ç®¡ç†å¼‚æ­¥çŠ¶æ€
3. âœ… ä½¿ç”¨ `createEntityAdapter` ç®¡ç†è§„èŒƒåŒ–æ•°æ®
4. âœ… åˆç†æ‹†åˆ† sliceï¼Œé¿å…å•ä¸ª reducer è¿‡å¤§

#### Zustand æœ€ä½³å®è·µ
1. âœ… ä½¿ç”¨åˆ‡ç‰‡æ¨¡å¼ç»„ç»‡å¤§å‹ store
2. âœ… ç”¨ `shallow` æˆ–åˆ†åˆ«è®¢é˜…é¿å…ä¸å¿…è¦çš„é‡æ¸²æŸ“
3. âœ… å¼‚æ­¥é€»è¾‘æ”¾åœ¨ action ä¸­ï¼Œä¿æŒ UI ç»„ä»¶çº¯ç²¹
4. âœ… åˆ©ç”¨ middleware æ‰©å±•åŠŸèƒ½ï¼ˆdevtoolsã€persistï¼‰

#### Jotai æœ€ä½³å®è·µ
1. âœ… ä¿æŒåŸå­ç²’åº¦ç»†ï¼Œä¸€ä¸ªåŸå­åªç®¡ä¸€ä»¶äº‹
2. âœ… ç”¨æ´¾ç”ŸåŸå­ï¼ˆderived atomsï¼‰ä»£æ›¿ useMemo
3. âœ… å¼‚æ­¥åŸå­ç»“åˆ Suspense ä½¿ç”¨
4. âœ… ä½¿ç”¨ `atomFamily` ç®¡ç†åŠ¨æ€æ•°æ®åˆ—è¡¨

---

## æ€»ç»“

é€‰æ‹©çŠ¶æ€ç®¡ç†æ–¹æ¡ˆæ²¡æœ‰é“¶å¼¹ï¼Œéœ€è¦ç»¼åˆè€ƒè™‘ï¼š

| å¦‚æœä½ çš„é¡¹ç›®... | æ¨èæ–¹æ¡ˆ |
|----------------|---------|
| æ˜¯å¤§å‹ä¼ä¸šåº”ç”¨ï¼Œéœ€è¦ä¸¥æ ¼è§„èŒƒ | **Redux Toolkit** |
| æ˜¯ä¸­å°å‹é¡¹ç›®ï¼Œè¿½æ±‚å¼€å‘æ•ˆç‡ | **Zustand** |
| å¯¹æ€§èƒ½æè‡´è¦æ±‚ï¼Œå¤§é‡ç»†ç²’åº¦çŠ¶æ€ | **Jotai** |
| éœ€è¦å¼ºå¤§çš„ DevTools å’Œè°ƒè¯•èƒ½åŠ› | **Redux** |
| å›¢é˜Ÿå¯¹ React 18+ ç‰¹æ€§ç†Ÿæ‚‰ | **Jotai** |
| éœ€è¦åœ¨ React å¤–ä½¿ç”¨çŠ¶æ€ | **Zustand** |

**è¶‹åŠ¿**ï¼šRedux ä»æ˜¯å¤§å‹é¡¹ç›®é¦–é€‰ï¼ŒZustand æ˜¯æ–°é¡¹ç›®çš„çƒ­é—¨é€‰æ‹©ï¼ŒJotai ä»£è¡¨ç€æœªæ¥æ–¹å‘ï¼ˆåŸå­åŒ– + Concurrentï¼‰ã€‚æŒæ¡å¤šç§æ–¹æ¡ˆï¼Œæ ¹æ®åœºæ™¯çµæ´»é€‰æ‹©æ‰æ˜¯æœ€ä½³ç­–ç•¥ã€‚
