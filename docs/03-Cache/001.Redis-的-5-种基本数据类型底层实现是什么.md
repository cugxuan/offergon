---
title: Redis 的 5 种基本数据类型底层实现是什么?
tags:
  - 缓存
  - 缓存
status: robot
class: 缓存
slug: redis-data-types-underlying-implementation
ref:
---

## 核心要点

Redis 五种基本数据类型的底层实现分别是:String(SDS)、List(ziplist/quicklist)、Hash(ziplist/hashtable)、Set(intset/hashtable)、ZSet(ziplist/skiplist+hashtable)。不同数据结构会根据元素数量和大小动态切换底层编码以优化性能。

## 详细回答

### 1. String (字符串)
**底层实现**: SDS (Simple Dynamic String,简单动态字符串)

**特点**:
- 与 C 字符串不同,SDS 预先分配空间,减少内存重分配次数
- 记录字符串长度,获取长度 O(1) 时间复杂度
- 二进制安全,可以存储任意二进制数据
- 兼容部分 C 字符串函数

**使用场景**: 缓存对象、计数器、分布式锁、Session 共享

### 2. List (列表)
**底层实现**:
- Redis 3.2 之前: ziplist (压缩列表) + linkedlist (双向链表)
- Redis 3.2 之后: quicklist (快速列表,ziplist 和 linkedlist 的混合体)

**编码转换条件**:
- quicklist 是 ziplist 和 linkedlist 的结合,每个节点是一个 ziplist
- 优点: 结合了 ziplist 的内存紧凑性和 linkedlist 的插入删除效率

**使用场景**: 消息队列、时间线、最新动态列表

### 3. Hash (哈希)
**底层实现**: ziplist (压缩列表) 或 hashtable (哈希表)

**编码转换条件**:
- 当哈希对象的所有键值对的键和值字符串长度都小于 64 字节,且键值对数量小于 512 个时,使用 ziplist
- 超过任一条件则转为 hashtable

**使用场景**: 存储对象、购物车、用户信息

### 4. Set (集合)
**底层实现**: intset (整数集合) 或 hashtable (哈希表)

**编码转换条件**:
- 当集合对象所有元素都是整数且元素数量不超过 512 个时,使用 intset
- 超过任一条件则转为 hashtable

**使用场景**: 标签系统、共同好友、去重

### 5. Sorted Set (有序集合)
**底层实现**: ziplist (压缩列表) 或 skiplist (跳跃表) + hashtable (哈希表)

**编码转换条件**:
- 当有序集合元素数量小于 128 个,且所有元素成员长度都小于 64 字节时,使用 ziplist
- 超过任一条件则使用 skiplist + hashtable 组合
  - skiplist 用于范围查询和有序遍历
  - hashtable 用于 O(1) 时间复杂度查找成员分数

**使用场景**: 排行榜、延时队列、优先级队列

### 底层数据结构说明

1. **SDS**: 动态字符串,记录长度和剩余空间,二进制安全
2. **ziplist**: 连续内存存储,节省空间但插入删除慢
3. **linkedlist**: 双向链表,插入删除快但内存开销大
4. **quicklist**: ziplist 和 linkedlist 结合,平衡性能和内存
5. **hashtable**: 哈希表,支持渐进式 rehash
6. **intset**: 有序整数数组,节省内存
7. **skiplist**: 跳跃表,支持平均 O(logN) 的查找和范围操作
