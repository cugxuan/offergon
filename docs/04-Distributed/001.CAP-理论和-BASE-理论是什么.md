---
title: CAP 理论和 BASE 理论是什么?如何在实际系统中权衡?
tags:
  - 分布式系统
  - 一致性
status: robot
class: 分布式系统
slug: cap-base-theory-system-tradeoffs
ref:
---

**要点提炼:**
- CAP 理论指分布式系统无法同时满足一致性(C)、可用性(A)、分区容错性(P),最多只能满足两个
- BASE 理论是 CAP 的延伸,强调基本可用、软状态、最终一致性,是对强一致性的妥协
- 实际系统中通常保证 AP 或 CP,根据业务场景权衡

## CAP 理论

CAP 理论由 Eric Brewer 提出,指分布式系统无法同时保证以下三个特性:

1. **Consistency(一致性)**: 所有节点在同一时间看到的数据是一致的
2. **Availability(可用性)**: 系统在任何时候都能响应请求(非故障节点)
3. **Partition Tolerance(分区容错性)**: 系统在网络分区的情况下仍能继续运行

**为什么只能满足两个?**

当网络分区发生时,必须在一致性和可用性之间做出选择:
- **选择 CP**: 为保证一致性,牺牲可用性,拒绝服务部分请求
- **选择 AP**: 为保证可用性,牺牲一致性,允许数据短暂不一致

## BASE 理论

BASE 是对 CAP 理论中 AP 方案的延伸和补充:

1. **Basically Available(基本可用)**: 系统允许损失部分可用性,但核心功能可用
2. **Soft State(软状态)**: 允许系统存在中间状态,不影响系统可用性
3. **Eventually Consistent(最终一致性)**: 经过一段时间后,数据最终会达到一致状态

## 实际系统中的权衡

**CP 系统(强一致性):**
- 适用场景: 金融交易、库存扣减、账户余额
- 典型系统: Zookeeper、HBase、etcd
- 特点: 可能牺牲部分可用性,保证数据绝对正确

**AP 系统(高可用):**
- 适用场景: 社交网络、内容推荐、日志收集
- 典型系统: Cassandra、DynamoDB、Eureka
- 特点: 牺牲强一致性,保证系统始终可用

**权衡策略:**
1. **业务分级**: 核心业务(支付)用 CP,非核心业务(评论)用 AP
2. **混合架构**: 同一系统不同模块采用不同策略
3. **最终一致性方案**: 使用消息队列、异步补偿等机制保证最终一致
4. **弱一致性容忍度**: 根据业务场景设置可接受的延迟窗口

**实践建议:**
- 金融支付系统优先选择 CP,确保资金安全
- 内容分发系统优先选择 AP,提升用户体验
- 电商库存系统可采用"预扣减 + 异步校验"的混合方案
- 使用分布式事务(TCC/Saga)在 AP 系统中实现最终一致性
