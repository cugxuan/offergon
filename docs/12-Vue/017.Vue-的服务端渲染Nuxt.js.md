---
title: Vue çš„æœåŠ¡ç«¯æ¸²æŸ“ï¼ˆNuxt.jsï¼‰
tags:
  - å‰ç«¯Vue
status: robot
class: å‰ç«¯Vue
slug: vue-server-side-rendering-nuxtjs
ref:
---

## æ ¸å¿ƒè¦ç‚¹

1. **SSRåŸç†**ï¼šåœ¨æœåŠ¡å™¨ç«¯æ‰§è¡ŒVueç»„ä»¶ï¼Œç”ŸæˆHTMLå­—ç¬¦ä¸²å‘é€ç»™æµè§ˆå™¨ï¼Œå†åœ¨å®¢æˆ·ç«¯æ¿€æ´»ï¼ˆhydrationï¼‰æˆå¯äº¤äº’åº”ç”¨
2. **æ ¸å¿ƒä¼˜åŠ¿**ï¼šæ›´å¥½çš„SEOã€æ›´å¿«çš„é¦–å±åŠ è½½ã€æ”¹å–„å¼±ç½‘ç¯å¢ƒä½“éªŒ
3. **Nuxt.jsæ¡†æ¶**ï¼šåŸºäºVueçš„SSRæ¡†æ¶ï¼Œæä¾›è‡ªåŠ¨è·¯ç”±ã€ç›®å½•ç»“æ„çº¦å®šã€æœåŠ¡ç«¯æ¸²æŸ“é…ç½®ç­‰å¼€ç®±å³ç”¨èƒ½åŠ›
4. **å…³é”®æŒ‘æˆ˜**ï¼šåŒæ„ä»£ç ç¼–å†™ã€ç”Ÿå‘½å‘¨æœŸé™åˆ¶ã€çŠ¶æ€ç®¡ç†å¤æ‚åº¦ã€æœåŠ¡å™¨èµ„æºæ¶ˆè€—

---

## è¯¦ç»†å›ç­”

æœåŠ¡ç«¯æ¸²æŸ“ï¼ˆSSRï¼‰æ˜¯ç°ä»£Webåº”ç”¨çš„é‡è¦æ¶æ„æ¨¡å¼ï¼Œä½œä¸ºä¸€åæœ‰æ·±åº¦ç»éªŒçš„å‰ç«¯å·¥ç¨‹å¸ˆï¼Œæˆ‘å°†ä»åŸç†åˆ°å®è·µå…¨é¢è®²è§£Vue SSRå’ŒNuxt.jsçš„æ ¸å¿ƒçŸ¥è¯†ã€‚

### ä¸€ã€SSR vs CSRï¼šä¸ºä»€ä¹ˆéœ€è¦æœåŠ¡ç«¯æ¸²æŸ“

#### 1. å®¢æˆ·ç«¯æ¸²æŸ“ï¼ˆCSRï¼‰çš„å±€é™æ€§

**ä¼ ç»ŸSPAæµç¨‹**ï¼š
```
1. æµè§ˆå™¨è¯·æ±‚ index.htmlï¼ˆå‡ ä¹ç©ºç™½ï¼Œåªæœ‰ä¸€ä¸ª <div id="app"></div>ï¼‰
2. ä¸‹è½½å¹¶è§£æ bundle.jsï¼ˆå¯èƒ½å‡ MBï¼‰
3. æ‰§è¡ŒJSï¼Œæ„å»ºè™šæ‹ŸDOM
4. æ¸²æŸ“çœŸå®DOM
5. å‘èµ·APIè¯·æ±‚è·å–æ•°æ®
6. å†æ¬¡æ¸²æŸ“
```

**é—®é¢˜**ï¼š
- **SEOå›°éš¾**ï¼šæœç´¢å¼•æ“çˆ¬è™«çœ‹åˆ°çš„æ˜¯ç©ºHTMLï¼Œæ— æ³•æŠ“å–å†…å®¹
- **é¦–å±ç™½å±æ—¶é—´é•¿**ï¼šç”¨æˆ·éœ€è¦ç­‰å¾…JSä¸‹è½½ã€è§£æã€æ‰§è¡Œåæ‰èƒ½çœ‹åˆ°å†…å®¹
- **å¼±ç½‘ç¯å¢ƒå·®**ï¼šåœ¨3G/4Gç½‘ç»œä¸‹ï¼Œå¤§bundleåŠ è½½éå¸¸æ…¢

#### 2. æœåŠ¡ç«¯æ¸²æŸ“ï¼ˆSSRï¼‰çš„ä¼˜åŠ¿

**SSRæµç¨‹**ï¼š
```
1. æµè§ˆå™¨è¯·æ±‚é¡µé¢
2. æœåŠ¡å™¨æ‰§è¡ŒVueç»„ä»¶ï¼Œç”Ÿæˆå®Œæ•´HTML
3. è¿”å›HTMLï¼ˆåŒ…å«å®Œæ•´å†…å®¹ï¼‰
4. æµè§ˆå™¨å±•ç¤ºé¡µé¢ï¼ˆç”¨æˆ·å·²ç»èƒ½çœ‹åˆ°å†…å®¹ï¼‰
5. ä¸‹è½½Vue.js
6. Hydrationï¼ˆæ¿€æ´»ï¼‰ï¼šVueæ¥ç®¡DOMï¼Œç»‘å®šäº‹ä»¶
```

**æ ¸å¿ƒä¼˜åŠ¿**ï¼š

| ç»´åº¦ | CSR | SSR |
|------|-----|-----|
| **SEO** | å·®ï¼ˆçˆ¬è™«çœ‹ä¸åˆ°å†…å®¹ï¼‰ | ä¼˜ç§€ï¼ˆHTMLåŒ…å«å®Œæ•´å†…å®¹ï¼‰ |
| **é¦–å±æ—¶é—´** | æ…¢ï¼ˆéœ€è¦ç­‰JSæ‰§è¡Œï¼‰ | å¿«ï¼ˆHTMLç›´æ¥å±•ç¤ºï¼‰ |
| **TTI** | è¾ƒæ…¢ | ä¸­ç­‰ |
| **æœåŠ¡å™¨å‹åŠ›** | å° | å¤§ |
| **å¼€å‘å¤æ‚åº¦** | ä½ | é«˜ |

**æœ€ä½³å®è·µåœºæ™¯**ï¼š
- âœ… å†…å®¹å‹ç½‘ç«™ï¼šåšå®¢ã€æ–°é—»ã€ç”µå•†å•†å“é¡µï¼ˆSEOé‡è¦ï¼‰
- âœ… è¥é”€è½åœ°é¡µï¼šéœ€è¦å¿«é€Ÿå±•ç¤ºå†…å®¹
- âŒ åå°ç®¡ç†ç³»ç»Ÿï¼šä¸éœ€è¦SEOï¼Œäº¤äº’å¤æ‚
- âŒ å®æ—¶åº”ç”¨ï¼šå¦‚èŠå¤©ã€åä½œå·¥å…·

### äºŒã€Vue SSR æ ¸å¿ƒåŸç†

#### 1. åŒæ„åº”ç”¨æ¶æ„

**ä»€ä¹ˆæ˜¯åŒæ„**ï¼š
åŒä¸€å¥—Vueä»£ç æ—¢èƒ½åœ¨æœåŠ¡å™¨ç«¯è¿è¡Œï¼ˆç”ŸæˆHTMLï¼‰ï¼Œä¹Ÿèƒ½åœ¨å®¢æˆ·ç«¯è¿è¡Œï¼ˆäº¤äº’ï¼‰ã€‚

**å…³é”®æ¦‚å¿µå›¾**ï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           Source Code (Vue)             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚                 â”‚
              â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
              â–¼         â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Server Entry â”‚  â”‚ Client Entry â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚                 â”‚
              â–¼                 â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Server Bundleâ”‚  â”‚ Client Bundleâ”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚                 â”‚
              â–¼                 â–¼
        Node.js Server      Browser
```

#### 2. å…³é”®æ­¥éª¤æ‹†è§£

**æ­¥éª¤1ï¼šæœåŠ¡å™¨ç«¯æ¸²æŸ“ï¼ˆrenderToStringï¼‰**

```javascript
// server.js
import { createSSRApp } from 'vue'
import { renderToString } from 'vue/server-renderer'
import App from './App.vue'

async function render(url) {
  // åˆ›å»ºVueåº”ç”¨å®ä¾‹
  const app = createSSRApp(App)

  // æ¸²æŸ“æˆHTMLå­—ç¬¦ä¸²
  const html = await renderToString(app)

  return `
    <!DOCTYPE html>
    <html>
      <head>
        <title>SSR App</title>
      </head>
      <body>
        <div id="app">${html}</div>
        <script src="/client.js"></script>
      </body>
    </html>
  `
}
```

**æ­¥éª¤2ï¼šå®¢æˆ·ç«¯æ¿€æ´»ï¼ˆHydrationï¼‰**

```javascript
// client.js
import { createSSRApp } from 'vue'
import App from './App.vue'

const app = createSSRApp(App)

// hydrate è€Œä¸æ˜¯ mount
// ä¼šå¤ç”¨æœåŠ¡å™¨æ¸²æŸ“çš„DOMï¼Œåªç»‘å®šäº‹ä»¶å’Œå“åº”å¼
app.mount('#app', true) // ç¬¬äºŒä¸ªå‚æ•°è¡¨ç¤ºhydrationæ¨¡å¼
```

**Hydrationè¯¦è§£**ï¼š

Hydrationä¸æ˜¯é‡æ–°æ¸²æŸ“DOMï¼Œè€Œæ˜¯ï¼š
1. æ£€æŸ¥æœåŠ¡å™¨æ¸²æŸ“çš„DOMç»“æ„
2. åˆ›å»ºå¯¹åº”çš„è™šæ‹ŸDOMæ ‘
3. ç»‘å®šäº‹ä»¶ç›‘å¬å™¨
4. æ¿€æ´»å“åº”å¼ç³»ç»Ÿ
5. è®©åº”ç”¨å˜æˆå¯äº¤äº’çš„

**å¸¸è§é—®é¢˜ - Hydrationä¸åŒ¹é…**ï¼š

```vue
<!-- âŒ é”™è¯¯ï¼šæœåŠ¡å™¨å’Œå®¢æˆ·ç«¯æ¸²æŸ“ç»“æœä¸ä¸€è‡´ -->
<template>
  <div>
    <!-- æœåŠ¡å™¨ç«¯æ²¡æœ‰ window å¯¹è±¡ -->
    <p>{{ window.innerWidth }}</p>

    <!-- éšæœºæ•°æ¯æ¬¡ä¸åŒ -->
    <p>{{ Math.random() }}</p>

    <!-- Date åœ¨æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯ä¸åŒ -->
    <p>{{ new Date() }}</p>
  </div>
</template>

<!-- âœ… æ­£ç¡®ï¼šä½¿ç”¨ onMounted ç¡®ä¿åªåœ¨å®¢æˆ·ç«¯æ‰§è¡Œ -->
<script setup>
import { ref, onMounted } from 'vue'

const width = ref(0)

onMounted(() => {
  width.value = window.innerWidth
})
</script>

<template>
  <div>
    <p>{{ width || 'Loading...' }}</p>
  </div>
</template>
```

#### 3. ç”Ÿå‘½å‘¨æœŸé™åˆ¶

åœ¨SSRä¸­ï¼Œåªæœ‰ `setup`ã€`beforeCreate`ã€`created` ä¼šåœ¨æœåŠ¡å™¨ç«¯æ‰§è¡Œã€‚

```javascript
export default {
  // âœ… æœåŠ¡å™¨ç«¯æ‰§è¡Œ
  setup() {
    // å¯ä»¥åœ¨è¿™é‡Œè·å–æ•°æ®
  },

  // âœ… æœåŠ¡å™¨ç«¯æ‰§è¡Œ
  created() {
    // å¯ä»¥åˆå§‹åŒ–æ•°æ®
  },

  // âŒ æœåŠ¡å™¨ç«¯ä¸æ‰§è¡Œ
  mounted() {
    // DOMæ“ä½œã€äº‹ä»¶ç›‘å¬ã€å®šæ—¶å™¨ç­‰åªèƒ½åœ¨è¿™é‡Œ
    console.log(document.body) // æœåŠ¡å™¨ç«¯æ²¡æœ‰document
  },

  // âŒ æœåŠ¡å™¨ç«¯ä¸æ‰§è¡Œ
  beforeUnmount() {},
  unmounted() {}
}
```

**æ³¨æ„äº‹é¡¹**ï¼š

```javascript
// âŒ å†…å­˜æ³„æ¼é£é™©
created() {
  // åœ¨æœåŠ¡å™¨ç«¯ï¼Œè¿™ä¸ªå®šæ—¶å™¨æ°¸è¿œä¸ä¼šè¢«æ¸…é™¤
  setInterval(() => {}, 1000)
}

// âœ… æ­£ç¡®åšæ³•
mounted() {
  // åªåœ¨å®¢æˆ·ç«¯åˆ›å»ºå®šæ—¶å™¨
  const timer = setInterval(() => {}, 1000)

  onBeforeUnmount(() => {
    clearInterval(timer)
  })
}
```

### ä¸‰ã€Nuxt.js æ¡†æ¶æ·±åº¦è§£æ

#### 1. ä¸ºä»€ä¹ˆé€‰æ‹© Nuxt.js

æ‰‹åŠ¨é…ç½®Vue SSRéå¸¸å¤æ‚ï¼Œéœ€è¦å¤„ç†ï¼š
- WebpackåŒç«¯é…ç½®
- è·¯ç”±æœåŠ¡å™¨ç«¯å¤„ç†
- æ•°æ®é¢„å–
- çŠ¶æ€ç®¡ç†åŒæ­¥
- ä»£ç åˆ†å‰²
- ...

**Nuxt.jsè§£å†³æ–¹æ¡ˆ**ï¼š
- ğŸ“ **çº¦å®šå¼è·¯ç”±**ï¼šåŸºäºæ–‡ä»¶ç»“æ„è‡ªåŠ¨ç”Ÿæˆè·¯ç”±
- ğŸ”„ **è‡ªåŠ¨ä»£ç åˆ†å‰²**ï¼šæ¯ä¸ªé¡µé¢è‡ªåŠ¨æ‰“åŒ…æˆç‹¬ç«‹chunk
- ğŸ¯ **æ•°æ®é¢„å–**ï¼š`asyncData`ã€`fetch` é’©å­
- ğŸ› ï¸ **å¼€ç®±å³ç”¨**ï¼šSSRã€SSGã€SPAå¤šæ¨¡å¼æ”¯æŒ
- ğŸ“¦ **æ¨¡å—ç”Ÿæ€**ï¼šä¸°å¯Œçš„Nuxtæ¨¡å—ï¼ˆPWAã€Sitemapç­‰ï¼‰

#### 2. Nuxt.js ç›®å½•ç»“æ„

```
my-nuxt-app/
â”œâ”€â”€ pages/              # é¡µé¢ç»„ä»¶ï¼ˆè‡ªåŠ¨ç”Ÿæˆè·¯ç”±ï¼‰
â”‚   â”œâ”€â”€ index.vue       # /
â”‚   â”œâ”€â”€ about.vue       # /about
â”‚   â””â”€â”€ users/
â”‚       â”œâ”€â”€ [id].vue    # /users/:id (åŠ¨æ€è·¯ç”±)
â”‚       â””â”€â”€ index.vue   # /users
â”œâ”€â”€ components/         # Vueç»„ä»¶ï¼ˆè‡ªåŠ¨å¯¼å…¥ï¼‰
â”œâ”€â”€ layouts/            # å¸ƒå±€ç»„ä»¶
â”‚   â”œâ”€â”€ default.vue     # é»˜è®¤å¸ƒå±€
â”‚   â””â”€â”€ blog.vue        # è‡ªå®šä¹‰å¸ƒå±€
â”œâ”€â”€ composables/        # ç»„åˆå¼å‡½æ•°ï¼ˆè‡ªåŠ¨å¯¼å…¥ï¼‰
â”œâ”€â”€ plugins/            # Vueæ’ä»¶
â”œâ”€â”€ middleware/         # è·¯ç”±ä¸­é—´ä»¶
â”œâ”€â”€ server/             # æœåŠ¡å™¨ç«¯ä»£ç 
â”‚   â”œâ”€â”€ api/            # APIè·¯ç”±
â”‚   â””â”€â”€ middleware/     # æœåŠ¡å™¨ä¸­é—´ä»¶
â”œâ”€â”€ public/             # é™æ€èµ„æº
â”œâ”€â”€ assets/             # éœ€è¦æ„å»ºçš„èµ„æº
â””â”€â”€ nuxt.config.ts      # Nuxté…ç½®
```

#### 3. æ ¸å¿ƒåŠŸèƒ½è¯¦è§£

**ï¼ˆ1ï¼‰è‡ªåŠ¨è·¯ç”±**

```
pages/
â”œâ”€â”€ index.vue           â†’ /
â”œâ”€â”€ about.vue           â†’ /about
â”œâ”€â”€ posts/
â”‚   â”œâ”€â”€ index.vue       â†’ /posts
â”‚   â”œâ”€â”€ [id].vue        â†’ /posts/:id
â”‚   â””â”€â”€ [...slug].vue   â†’ /posts/* (é€šé…ç¬¦)
â””â”€â”€ admin/
    â””â”€â”€ settings.vue    â†’ /admin/settings
```

**åŠ¨æ€è·¯ç”±ç¤ºä¾‹**ï¼š

```vue
<!-- pages/posts/[id].vue -->
<script setup>
// è‡ªåŠ¨è·å–è·¯ç”±å‚æ•°
const route = useRoute()
const id = route.params.id

// æœåŠ¡å™¨ç«¯æ•°æ®é¢„å–
const { data: post } = await useFetch(`/api/posts/${id}`)
</script>

<template>
  <div>
    <h1>{{ post.title }}</h1>
    <p>{{ post.content }}</p>
  </div>
</template>
```

**ï¼ˆ2ï¼‰æ•°æ®è·å–**

Nuxt 3æä¾›å¤šç§æ•°æ®è·å–æ–¹å¼ï¼š

```vue
<script setup>
// 1. useFetchï¼šè‡ªåŠ¨å¤„ç†è¯·æ±‚ã€ç¼“å­˜ã€é‡å¤è¯·æ±‚
const { data, pending, error, refresh } = await useFetch('/api/articles')

// 2. useAsyncDataï¼šæ›´çµæ´»çš„æ•°æ®è·å–
const { data: user } = await useAsyncData('user', () => {
  return $fetch('/api/user')
})

// 3. $fetchï¼šç±»ä¼¼fetchï¼Œä½†æœ‰æ›´å¥½çš„ç±»å‹æ¨æ–­
const article = await $fetch('/api/articles/1')
</script>

<template>
  <div>
    <div v-if="pending">åŠ è½½ä¸­...</div>
    <div v-else-if="error">åŠ è½½å¤±è´¥: {{ error }}</div>
    <div v-else>
      <ArticleList :articles="data" />
    </div>
  </div>
</template>
```

**å…³é”®ç‰¹æ€§**ï¼š

```vue
<script setup>
const { data, refresh, pending } = await useFetch('/api/todos', {
  // åªåœ¨æœåŠ¡å™¨ç«¯æ‰§è¡Œ
  server: true,

  // å»¶è¿Ÿå®¢æˆ·ç«¯æ‰§è¡Œï¼ˆé¿å…é‡å¤è¯·æ±‚ï¼‰
  lazy: false,

  // ç«‹å³æ‰§è¡Œ
  immediate: true,

  // ç›‘å¬å‚æ•°å˜åŒ–è‡ªåŠ¨é‡æ–°è¯·æ±‚
  watch: [keyword],

  // è¯·æ±‚æ‹¦æˆª
  onRequest({ request, options }) {
    options.headers = options.headers || {}
    options.headers.authorization = 'Bearer token'
  },

  // å“åº”æ‹¦æˆª
  onResponse({ response }) {
    return response._data.data
  }
})
</script>
```

**ï¼ˆ3ï¼‰çŠ¶æ€ç®¡ç†ï¼ˆuseStateï¼‰**

Nuxtæä¾›è·¨ç»„ä»¶å…±äº«çŠ¶æ€çš„composableï¼š

```javascript
// composables/useCounter.js
export const useCounter = () => {
  return useState('counter', () => 0)
}

// pages/index.vue
const count = useCounter()
count.value++

// components/Header.vue
const count = useCounter() // å…±äº«åŒä¸€ä¸ªçŠ¶æ€
```

**åŸç†**ï¼š
- æœåŠ¡å™¨ç«¯ï¼šæ¯ä¸ªè¯·æ±‚ç‹¬ç«‹çš„çŠ¶æ€å®ä¾‹
- å®¢æˆ·ç«¯ï¼šå…¨å±€å•ä¾‹çŠ¶æ€
- è‡ªåŠ¨åºåˆ—åŒ–/ååºåˆ—åŒ–

**ï¼ˆ4ï¼‰æ¸²æŸ“æ¨¡å¼**

```javascript
// nuxt.config.ts
export default defineNuxtConfig({
  // æ¨¡å¼1ï¼šSSRï¼ˆé»˜è®¤ï¼‰
  ssr: true,

  // æ¨¡å¼2ï¼šSSGï¼ˆé™æ€ç«™ç‚¹ç”Ÿæˆï¼‰
  // æ„å»ºæ—¶é¢„æ¸²æŸ“æ‰€æœ‰è·¯ç”±
  ssr: true,
  nitro: {
    prerender: {
      routes: ['/', '/about', '/posts/1']
    }
  },

  // æ¨¡å¼3ï¼šSPA
  ssr: false,

  // æ··åˆæ¨¡å¼ï¼šé¡µé¢çº§æ§åˆ¶
  routeRules: {
    '/': { prerender: true },        // é¦–é¡µé¢„æ¸²æŸ“
    '/admin/**': { ssr: false },     // åå°SPAæ¨¡å¼
    '/api/**': { cors: true },       // APIå¯ç”¨CORS
    '/blog/**': { swr: 3600 },       // åšå®¢å¯ç”¨å¢é‡é™æ€å†ç”Ÿæˆ
  }
})
```

**å¢é‡é™æ€å†ç”Ÿæˆï¼ˆISRï¼‰**ï¼š

```javascript
export default defineNuxtConfig({
  routeRules: {
    // æ¯3600ç§’é‡æ–°ç”Ÿæˆ
    '/blog/**': { swr: 3600 }
  }
})
```

å·¥ä½œåŸç†ï¼š
1. é¦–æ¬¡è®¿é—®æ—¶SSRæ¸²æŸ“å¹¶ç¼“å­˜
2. ç¼“å­˜æœŸå†…ç›´æ¥è¿”å›ç¼“å­˜HTMLï¼ˆæå¿«ï¼‰
3. è¿‡æœŸååå°é‡æ–°ç”Ÿæˆï¼Œç”¨æˆ·ä»çœ‹åˆ°æ—§å†…å®¹
4. ä¸‹æ¬¡è®¿é—®çœ‹åˆ°æ–°å†…å®¹

**ï¼ˆ5ï¼‰ä¸­é—´ä»¶**

```javascript
// middleware/auth.ts
export default defineNuxtRouteMiddleware((to, from) => {
  const user = useState('user')

  // æœªç™»å½•è·³è½¬åˆ°ç™»å½•é¡µ
  if (!user.value && to.path !== '/login') {
    return navigateTo('/login')
  }
})

// pages/admin.vue
<script setup>
definePageMeta({
  middleware: 'auth'  // åº”ç”¨ä¸­é—´ä»¶
})
</script>
```

**å…¨å±€ä¸­é—´ä»¶**ï¼š

```javascript
// middleware/analytics.global.ts
export default defineNuxtRouteMiddleware((to, from) => {
  // å‘é€é¡µé¢æµè§ˆç»Ÿè®¡
  if (process.client) {
    gtag('event', 'page_view', { page_path: to.path })
  }
})
```

### å››ã€SSR å®æˆ˜æ¡ˆä¾‹

#### æ¡ˆä¾‹ï¼šåšå®¢æ–‡ç« è¯¦æƒ…é¡µä¼˜åŒ–

**éœ€æ±‚**ï¼š
- æ–‡ç« å†…å®¹éœ€è¦SEO
- é¦–å±å¿«é€Ÿå±•ç¤º
- è¯„è®ºåŒºå¯ä»¥å»¶è¿ŸåŠ è½½

**å®ç°**ï¼š

```vue
<!-- pages/posts/[id].vue -->
<script setup>
const route = useRoute()
const id = route.params.id

// 1. æœåŠ¡å™¨ç«¯é¢„å–æ–‡ç« æ•°æ®ï¼ˆå…³é”®å†…å®¹ï¼‰
const { data: post } = await useFetch(`/api/posts/${id}`, {
  key: `post-${id}`,
  // ç¡®ä¿æœåŠ¡å™¨ç«¯æ‰§è¡Œ
  server: true
})

// 2. è¯„è®ºå»¶è¿ŸåŠ è½½ï¼ˆéå…³é”®å†…å®¹ï¼‰
const { data: comments } = await useFetch(`/api/posts/${id}/comments`, {
  // åªåœ¨å®¢æˆ·ç«¯æ‰§è¡Œ
  server: false,
  lazy: true
})

// 3. SEOä¼˜åŒ–
useHead({
  title: post.value?.title,
  meta: [
    { name: 'description', content: post.value?.summary },
    { property: 'og:title', content: post.value?.title },
    { property: 'og:image', content: post.value?.coverImage }
  ]
})
</script>

<template>
  <article>
    <!-- æœåŠ¡å™¨ç«¯æ¸²æŸ“çš„æ ¸å¿ƒå†…å®¹ -->
    <h1>{{ post.title }}</h1>
    <div v-html="post.content"></div>

    <!-- å®¢æˆ·ç«¯å»¶è¿ŸåŠ è½½çš„è¯„è®º -->
    <div class="comments">
      <h2>è¯„è®º</h2>
      <div v-if="!comments">åŠ è½½ä¸­...</div>
      <CommentList v-else :comments="comments" />
    </div>
  </article>
</template>
```

**æ•ˆæœ**ï¼š
- HTMLåŒ…å«å®Œæ•´æ–‡ç« å†…å®¹ï¼ˆSEOå‹å¥½ï¼‰
- é¦–å±åŠ è½½æ—¶é—´ < 1s
- è¯„è®ºåŒºä¸é˜»å¡ä¸»å†…å®¹å±•ç¤º

#### æ¡ˆä¾‹ï¼šç”µå•†å•†å“é¡µæ€§èƒ½ä¼˜åŒ–

```vue
<script setup>
const route = useRoute()
const productId = route.params.id

// å¹¶è¡Œè¯·æ±‚å¤šä¸ªAPI
const [
  { data: product },
  { data: reviews },
  { data: recommendations }
] = await Promise.all([
  useFetch(`/api/products/${productId}`, { server: true }),
  useFetch(`/api/products/${productId}/reviews`, { server: false, lazy: true }),
  useFetch(`/api/recommendations`, { server: false, lazy: true })
])

// ç»“æ„åŒ–æ•°æ®ï¼ˆSchema.orgï¼‰
useHead({
  script: [
    {
      type: 'application/ld+json',
      children: JSON.stringify({
        '@context': 'https://schema.org',
        '@type': 'Product',
        name: product.value?.name,
        image: product.value?.images,
        description: product.value?.description,
        offers: {
          '@type': 'Offer',
          price: product.value?.price,
          priceCurrency: 'CNY'
        }
      })
    }
  ]
})
</script>

<template>
  <div>
    <!-- æ ¸å¿ƒå•†å“ä¿¡æ¯ - æœåŠ¡å™¨ç«¯æ¸²æŸ“ -->
    <ProductInfo :product="product" />

    <!-- è¯„è®ºå’Œæ¨è - å®¢æˆ·ç«¯åŠ è½½ -->
    <ClientOnly>
      <Reviews :reviews="reviews" />
      <Recommendations :products="recommendations" />
    </ClientOnly>
  </div>
</template>
```

### äº”ã€SSR å¸¸è§é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ

#### 1. ç¬¬ä¸‰æ–¹åº“å…¼å®¹æ€§é—®é¢˜

**é—®é¢˜**ï¼šå¾ˆå¤šåº“ä½¿ç”¨äº†æµè§ˆå™¨APIï¼ˆå¦‚ `window`ã€`document`ï¼‰

**è§£å†³æ–¹æ¡ˆ**ï¼š

```vue
<script setup>
// æ–¹æ¡ˆ1ï¼šClientOnlyç»„ä»¶
</script>

<template>
  <ClientOnly>
    <VueEditor />
  </ClientOnly>
</template>

<!-- æ–¹æ¡ˆ2ï¼šåŠ¨æ€å¯¼å…¥ -->
<script setup>
import { defineAsyncComponent } from 'vue'

const VueEditor = defineAsyncComponent(() => {
  if (process.client) {
    return import('vue-editor-component')
  }
  return Promise.resolve({ render: () => null })
})
</script>

<!-- æ–¹æ¡ˆ3ï¼šæ’ä»¶é…ç½® -->
<!-- nuxt.config.ts -->
export default defineNuxtConfig({
  plugins: [
    { src: '~/plugins/vue-editor', mode: 'client' }
  ]
})
```

#### 2. çŠ¶æ€ç®¡ç†åŒæ­¥

**é—®é¢˜**ï¼šæœåŠ¡å™¨ç«¯å’Œå®¢æˆ·ç«¯çŠ¶æ€ä¸åŒæ­¥

**è§£å†³æ–¹æ¡ˆ**ï¼š

```javascript
// Nuxtè‡ªåŠ¨å¤„ç†çŠ¶æ€åºåˆ—åŒ–
const user = useState('user', () => ({
  name: 'John',
  id: 1
}))

// Nuxtä¼šå°†çŠ¶æ€æ³¨å…¥åˆ°HTMLä¸­ï¼š
// <script>window.__NUXT__={state:{user:{name:'John',id:1}}}</script>
// å®¢æˆ·ç«¯ä¼šè‡ªåŠ¨æ¢å¤è¿™ä¸ªçŠ¶æ€
```

#### 3. ç¼“å­˜ç­–ç•¥

```javascript
// nuxt.config.ts
export default defineNuxtConfig({
  routeRules: {
    // é™æ€é¡µé¢é•¿æœŸç¼“å­˜
    '/about': {
      headers: {
        'cache-control': 'public, max-age=31536000, immutable'
      }
    },

    // åŠ¨æ€å†…å®¹çŸ­æœŸç¼“å­˜
    '/api/news': {
      headers: {
        'cache-control': 'public, max-age=300, s-maxage=600'
      }
    },

    // ä¸ªæ€§åŒ–å†…å®¹ä¸ç¼“å­˜
    '/api/user/**': {
      headers: {
        'cache-control': 'private, no-cache'
      }
    }
  }
})
```

### å…­ã€æ€§èƒ½ä¼˜åŒ–å»ºè®®

#### 1. èµ„æºä¼˜åŒ–

```javascript
// nuxt.config.ts
export default defineNuxtConfig({
  experimental: {
    // å¯ç”¨ payload æå–
    payloadExtraction: true
  },

  // ä¼˜åŒ–å›¾ç‰‡
  image: {
    provider: 'ipx',
    quality: 80,
    formats: ['webp', 'avif']
  },

  // ä»£ç åˆ†å‰²
  vite: {
    build: {
      rollupOptions: {
        output: {
          manualChunks: {
            'vendor': ['vue', 'vue-router'],
            'ui': ['element-plus']
          }
        }
      }
    }
  }
})
```

#### 2. ç›‘æ§æŒ‡æ ‡

```javascript
// æœåŠ¡å™¨ç«¯æ€§èƒ½ç›‘æ§
export default defineEventHandler((event) => {
  const start = Date.now()

  event.node.res.on('finish', () => {
    const duration = Date.now() - start
    console.log(`Request to ${event.path} took ${duration}ms`)

    // å‘é€åˆ°ç›‘æ§ç³»ç»Ÿ
    if (duration > 1000) {
      alert(`Slow request: ${event.path}`)
    }
  })
})
```

---

## æ€»ç»“

Vue SSRå’ŒNuxt.jsæ˜¯æ„å»ºé«˜æ€§èƒ½ã€SEOå‹å¥½Webåº”ç”¨çš„å¼ºå¤§å·¥å…·ï¼Œå…³é”®è¦ç‚¹ï¼š

**ä½•æ—¶ä½¿ç”¨SSR**ï¼š
- âœ… éœ€è¦SEOçš„å†…å®¹å‹ç½‘ç«™
- âœ… é¦–å±æ€§èƒ½è¦æ±‚é«˜
- âœ… ç¤¾äº¤åˆ†äº«éœ€è¦é¢„è§ˆå¡ç‰‡
- âŒ çº¯åå°ç®¡ç†ç³»ç»Ÿ
- âŒ é«˜åº¦äº¤äº’çš„å®æ—¶åº”ç”¨

**æ ¸å¿ƒæŒ‘æˆ˜**ï¼š
1. åŒæ„ä»£ç ç¼–å†™å¤æ‚åº¦
2. æœåŠ¡å™¨èµ„æºæ¶ˆè€—
3. ç¬¬ä¸‰æ–¹åº“å…¼å®¹æ€§
4. çŠ¶æ€ç®¡ç†å¤æ‚åº¦

**æœ€ä½³å®è·µ**ï¼š
1. å…³é”®å†…å®¹SSRï¼Œéå…³é”®å†…å®¹CSR
2. åˆç†ä½¿ç”¨ç¼“å­˜ç­–ç•¥
3. ç›‘æ§æœåŠ¡å™¨æ€§èƒ½
4. æ¸è¿›å¼å¢å¼ºï¼ˆProgressive Enhancementï¼‰

é€šè¿‡åˆç†è¿ç”¨SSRæŠ€æœ¯ï¼Œå¯ä»¥åœ¨SEOã€æ€§èƒ½ã€ç”¨æˆ·ä½“éªŒä¹‹é—´å–å¾—æœ€ä½³å¹³è¡¡ã€‚Nuxt.jsä½œä¸ºæˆç†Ÿçš„æ¡†æ¶ï¼Œæå¤§é™ä½äº†SSRçš„å¼€å‘å’Œç»´æŠ¤æˆæœ¬ï¼Œæ˜¯Vueç”Ÿæ€ä¸­ä¸å¯æˆ–ç¼ºçš„å·¥å…·ã€‚
