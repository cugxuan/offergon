---
title: Vue 的生命周期钩子和执行顺序
tags:
  - Vue
status: robot
class: 前端Vue
slug: vue-lifecycle-hooks-execution-order
ref:
---

## 核心要点

- **创建阶段**：beforeCreate → created（数据初始化完成）
- **挂载阶段**：beforeMount → mounted（DOM 挂载完成，可以访问 $el）
- **更新阶段**：beforeUpdate → updated（数据变化触发重新渲染）
- **销毁阶段**：beforeUnmount → unmounted（清理工作，解除绑定）
- **父子组件执行顺序**：父组件创建 → 子组件创建 → 子组件挂载 → 父组件挂载

---

## 详细解答

### 一、Vue 3 生命周期钩子完整列表

Vue 3 提供了一系列生命周期钩子函数，用于在组件的不同阶段执行特定逻辑。

#### 选项式 API 钩子

```javascript
export default {
  // 1. 创建阶段
  beforeCreate() {},  // 实例初始化之后，数据观测之前
  created() {},       // 实例创建完成，数据观测、属性和方法的运算、watch/event 事件回调已配置

  // 2. 挂载阶段
  beforeMount() {},   // 挂载开始之前，render 函数首次被调用
  mounted() {},       // 实例被挂载后，el 被新创建的 vm.$el 替换

  // 3. 更新阶段
  beforeUpdate() {},  // 数据更新时，虚拟 DOM 重新渲染和打补丁之前
  updated() {},       // 数据更新后，虚拟 DOM 重新渲染和打补丁之后

  // 4. 销毁阶段
  beforeUnmount() {}, // 实例销毁之前（Vue 2 中叫 beforeDestroy）
  unmounted() {},     // 实例销毁之后（Vue 2 中叫 destroyed）

  // 5. 特殊钩子
  activated() {},     // 被 keep-alive 缓存的组件激活时调用
  deactivated() {},   // 被 keep-alive 缓存的组件停用时调用

  // 6. 错误捕获
  errorCaptured() {}  // 捕获子孙组件的错误
}
```

#### Composition API 钩子

```javascript
import {
  onBeforeMount,
  onMounted,
  onBeforeUpdate,
  onUpdated,
  onBeforeUnmount,
  onUnmounted,
  onActivated,
  onDeactivated,
  onErrorCaptured
} from 'vue'

export default {
  setup() {
    // 注意：setup 本身就相当于 beforeCreate 和 created
    console.log('setup 执行')

    onBeforeMount(() => {
      console.log('onBeforeMount')
    })

    onMounted(() => {
      console.log('onMounted')
    })

    onBeforeUpdate(() => {
      console.log('onBeforeUpdate')
    })

    onUpdated(() => {
      console.log('onUpdated')
    })

    onBeforeUnmount(() => {
      console.log('onBeforeUnmount')
    })

    onUnmounted(() => {
      console.log('onUnmounted')
    })

    onActivated(() => {
      console.log('onActivated')
    })

    onDeactivated(() => {
      console.log('onDeactivated')
    })

    onErrorCaptured((err, instance, info) => {
      console.log('errorCaptured:', err)
    })
  }
}
```

### 二、单个组件的生命周期执行顺序

#### 完整的生命周期流程图

```
┌─────────────────┐
│   实例初始化     │
└────────┬────────┘
         │
         ▼
   beforeCreate
         │
         ▼
┌─────────────────┐
│   初始化数据     │
│  (data, props)  │
└────────┬────────┘
         │
         ▼
     created
         │
         ▼
   是否有 el 选项?
     /         \
   NO          YES
    │           │
    │           ▼
    │     是否有 template?
    │        /         \
    │       NO         YES
    │       │           │
    │       ▼           ▼
    │  编译 el         编译 template
    │    outerHTML      为 render 函数
    │       │           │
    │       └─────┬─────┘
    │             │
    └─────────────┤
                  ▼
          beforeMount
                  │
                  ▼
         ┌─────────────────┐
         │  创建虚拟 DOM    │
         │  渲染到真实 DOM  │
         └────────┬────────┘
                  │
                  ▼
            mounted
                  │
                  ▼
         ┌─────────────────┐
         │   组件运行中     │
         └────────┬────────┘
                  │
         数据变化时触发
                  │
                  ▼
          beforeUpdate
                  │
                  ▼
         ┌─────────────────┐
         │  重新渲染 DOM    │
         └────────┬────────┘
                  │
                  ▼
            updated
                  │
                  │
         调用 unmount 时
                  │
                  ▼
         beforeUnmount
                  │
                  ▼
         ┌─────────────────┐
         │  解除绑定、监听  │
         │  销毁子组件      │
         └────────┬────────┘
                  │
                  ▼
           unmounted
```

#### 代码示例验证执行顺序

```javascript
<template>
  <div>
    <h1>{{ message }}</h1>
    <button @click="updateMessage">更新消息</button>
  </div>
</template>

<script>
export default {
  name: 'LifecycleDemo',
  data() {
    return {
      message: 'Hello Vue!'
    }
  },

  beforeCreate() {
    console.log('1. beforeCreate - 实例初始化')
    console.log('   data:', this.message) // undefined
    console.log('   $el:', this.$el) // undefined
  },

  created() {
    console.log('2. created - 数据已初始化')
    console.log('   data:', this.message) // 'Hello Vue!'
    console.log('   $el:', this.$el) // undefined
    // 适合：发起 API 请求、初始化数据
  },

  beforeMount() {
    console.log('3. beforeMount - 挂载前')
    console.log('   $el:', this.$el) // undefined 或旧的 DOM
    // 模板已编译，但还未挂载到真实 DOM
  },

  mounted() {
    console.log('4. mounted - 挂载完成')
    console.log('   $el:', this.$el) // 真实 DOM 元素
    // 适合：DOM 操作、启动定时器、订阅事件
  },

  beforeUpdate() {
    console.log('5. beforeUpdate - 数据变化，更新前')
    console.log('   DOM 中的值:', document.querySelector('h1').innerText)
    console.log('   data 中的值:', this.message)
    // DOM 还是旧值，data 是新值
  },

  updated() {
    console.log('6. updated - 更新完成')
    console.log('   DOM 中的值:', document.querySelector('h1').innerText)
    console.log('   data 中的值:', this.message)
    // DOM 和 data 都是新值
    // 注意：避免在这里修改数据，会导致无限循环
  },

  beforeUnmount() {
    console.log('7. beforeUnmount - 销毁前')
    console.log('   实例仍然可用')
    // 适合：清理定时器、取消订阅
  },

  unmounted() {
    console.log('8. unmounted - 销毁完成')
    // 所有指令解绑、事件监听器移除、子组件销毁
  },

  methods: {
    updateMessage() {
      this.message = 'Updated!'
    }
  }
}
</script>
```

**输出顺序：**

```
1. beforeCreate - 实例初始化
   data: undefined
   $el: undefined

2. created - 数据已初始化
   data: Hello Vue!
   $el: undefined

3. beforeMount - 挂载前
   $el: undefined

4. mounted - 挂载完成
   $el: <div>...</div>

// 点击按钮后：
5. beforeUpdate - 数据变化，更新前
   DOM 中的值: Hello Vue!
   data 中的值: Updated!

6. updated - 更新完成
   DOM 中的值: Updated!
   data 中的值: Updated!

// 组件销毁时：
7. beforeUnmount - 销毁前
   实例仍然可用

8. unmounted - 销毁完成
```

### 三、父子组件的生命周期执行顺序

这是面试中的高频考点！

#### 挂载阶段（从外到内，再从内到外）

```javascript
// 父组件
<template>
  <div>
    <p>Parent Component</p>
    <ChildComponent />
  </div>
</template>

<script>
export default {
  name: 'ParentComponent',

  beforeCreate() {
    console.log('Parent: beforeCreate')
  },
  created() {
    console.log('Parent: created')
  },
  beforeMount() {
    console.log('Parent: beforeMount')
  },
  mounted() {
    console.log('Parent: mounted')
  }
}
</script>

// 子组件
<template>
  <div>Child Component</div>
</template>

<script>
export default {
  name: 'ChildComponent',

  beforeCreate() {
    console.log('Child: beforeCreate')
  },
  created() {
    console.log('Child: created')
  },
  beforeMount() {
    console.log('Child: beforeMount')
  },
  mounted() {
    console.log('Child: mounted')
  }
}
</script>
```

**执行顺序：**

```
Parent: beforeCreate
Parent: created
Parent: beforeMount
  Child: beforeCreate
  Child: created
  Child: beforeMount
  Child: mounted
Parent: mounted
```

**记忆口诀：父创建 → 子创建 → 子挂载 → 父挂载**

#### 更新阶段

```javascript
// 父组件更新（影响子组件）
Parent: beforeUpdate
  Child: beforeUpdate
  Child: updated
Parent: updated

// 子组件自身更新（不影响父组件）
Child: beforeUpdate
Child: updated
```

#### 销毁阶段

```javascript
Parent: beforeUnmount
  Child: beforeUnmount
  Child: unmounted
Parent: unmounted
```

**口诀：父销毁前 → 子销毁前 → 子销毁完 → 父销毁完**

### 四、多个兄弟组件的执行顺序

```javascript
<template>
  <div>
    <Child1 />
    <Child2 />
    <Child3 />
  </div>
</template>
```

**执行顺序：**

```
Parent: beforeCreate
Parent: created
Parent: beforeMount
  Child1: beforeCreate
  Child1: created
  Child1: beforeMount
  Child1: mounted

  Child2: beforeCreate
  Child2: created
  Child2: beforeMount
  Child2: mounted

  Child3: beforeCreate
  Child3: created
  Child3: beforeMount
  Child3: mounted
Parent: mounted
```

**特点：兄弟组件按照模板中的声明顺序依次挂载**

### 五、各生命周期钩子的常见用途

#### 1. beforeCreate

```javascript
beforeCreate() {
  // 此时还无法访问 data、computed、methods
  // 很少使用，一般用于插件开发
  console.log('实例刚刚被创建')
}
```

#### 2. created ⭐（最常用）

```javascript
created() {
  // 数据已初始化，但 DOM 还未生成
  // 适合场景：

  // 1. 发起 API 请求
  this.fetchUserData()

  // 2. 初始化非响应式数据
  this.timer = null

  // 3. 简单的数据处理
  this.processedData = this.rawData.map(item => ({
    ...item,
    formatted: true
  }))
}
```

#### 3. beforeMount

```javascript
beforeMount() {
  // 模板编译完成，但还未挂载
  // 很少使用
  console.log('即将挂载')
}
```

#### 4. mounted ⭐（最常用）

```javascript
mounted() {
  // DOM 已挂载，可以访问真实 DOM
  // 适合场景：

  // 1. DOM 操作
  this.$refs.canvas.getContext('2d')

  // 2. 启动定时器
  this.timer = setInterval(() => {
    this.updateTime()
  }, 1000)

  // 3. 监听窗口事件
  window.addEventListener('resize', this.handleResize)

  // 4. 第三方库初始化
  this.chart = new Chart(this.$refs.chartContainer, {
    type: 'line',
    data: this.chartData
  })

  // 5. 获取元素尺寸
  const width = this.$el.offsetWidth
}
```

#### 5. beforeUpdate

```javascript
beforeUpdate() {
  // 数据已更新，DOM 还未更新
  // 适合获取更新前的 DOM 状态

  const scrollHeight = this.$refs.list.scrollHeight
  console.log('更新前高度:', scrollHeight)
}
```

#### 6. updated ⚠️（谨慎使用）

```javascript
updated() {
  // DOM 已更新
  // 适合需要访问更新后 DOM 的场景

  // 1. 获取更新后的 DOM 尺寸
  this.$nextTick(() => {
    const newHeight = this.$refs.list.scrollHeight
  })

  // ⚠️ 警告：不要在这里修改数据，会导致无限循环
  // this.count++ // ❌ 错误！会触发无限更新
}
```

#### 7. beforeUnmount ⭐（重要：清理工作）

```javascript
beforeUnmount() {
  // 组件即将销毁，实例仍然可用
  // 适合场景：

  // 1. 清除定时器
  if (this.timer) {
    clearInterval(this.timer)
    this.timer = null
  }

  // 2. 移除事件监听
  window.removeEventListener('resize', this.handleResize)

  // 3. 取消网络请求
  this.cancelToken.cancel('Component unmounted')

  // 4. 清理第三方库实例
  if (this.chart) {
    this.chart.destroy()
  }
}
```

#### 8. unmounted

```javascript
unmounted() {
  // 组件已销毁
  // 少用，主要用于调试
  console.log('组件已完全销毁')
}
```

### 六、特殊场景的生命周期

#### 1. keep-alive 组件

```javascript
<template>
  <keep-alive>
    <component :is="currentView" />
  </keep-alive>
</template>

<script>
export default {
  activated() {
    console.log('组件被激活')
    // 每次从缓存中取出时调用
    // 适合：重新获取数据、重新开启定时器
    this.fetchLatestData()
  },

  deactivated() {
    console.log('组件被停用')
    // 每次被缓存时调用
    // 适合：暂停定时器、保存状态
    clearInterval(this.timer)
  }
}
</script>
```

**执行顺序：**

```
首次进入：
beforeCreate → created → beforeMount → mounted → activated

切换离开（被缓存）：
deactivated

再次进入（从缓存中恢复）：
activated
```

#### 2. 异步组件

```javascript
// 异步组件的生命周期会延迟执行
const AsyncComponent = defineAsyncComponent(() =>
  import('./AsyncComponent.vue')
)

// 组件加载完成后才会执行生命周期钩子
```

### 七、Vue 2 与 Vue 3 的区别

| Vue 2 | Vue 3 | 说明 |
|-------|-------|------|
| beforeDestroy | beforeUnmount | 销毁前钩子改名 |
| destroyed | unmounted | 销毁后钩子改名 |
| - | setup() | 新增，相当于 beforeCreate + created |

### 八、面试常见问题

#### Q1: 在哪个生命周期发起异步请求？

**答：created 或 mounted 都可以，推荐 created**

```javascript
created() {
  // 推荐：更早获取数据，减少白屏时间
  this.fetchData()
}

mounted() {
  // 如果需要 DOM 信息作为请求参数，用 mounted
  const width = this.$el.offsetWidth
  this.fetchDataByWidth(width)
}
```

#### Q2: 父子组件挂载顺序是什么？

**答：父 beforeCreate → 父 created → 父 beforeMount → 子 beforeCreate → 子 created → 子 beforeMount → 子 mounted → 父 mounted**

#### Q3: 为什么不能在 updated 中修改数据？

```javascript
updated() {
  // ❌ 错误示范
  this.count++ // 会触发新的更新 → 再次调用 updated → 无限循环
}

// ✅ 正确做法
updated() {
  this.$nextTick(() => {
    // 只做 DOM 相关操作，不修改数据
    this.updateChartSize()
  })
}
```

#### Q4: 什么时候清理副作用？

**答：在 beforeUnmount 中清理**

```javascript
beforeUnmount() {
  // 清理定时器
  clearInterval(this.timer)

  // 移除事件监听
  window.removeEventListener('scroll', this.handleScroll)

  // 销毁第三方库实例
  this.editor.destroy()
}
```

### 九、最佳实践总结

1. **数据初始化**：created
2. **DOM 操作**：mounted
3. **清理工作**：beforeUnmount（必须！避免内存泄漏）
4. **避免在 updated 中修改数据**
5. **父子组件通信考虑生命周期顺序**
6. **异步组件注意钩子延迟执行**
