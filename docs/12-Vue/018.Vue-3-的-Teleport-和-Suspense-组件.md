---
title: Vue 3 çš„ Teleport å’Œ Suspense ç»„ä»¶
tags:
  - å‰ç«¯Vue
status: robot
class: å‰ç«¯Vue
slug: vue-3-teleport-suspense-components
ref:
---

## æ ¸å¿ƒè¦ç‚¹

1. **Teleportä¼ é€é—¨**ï¼šå°†ç»„ä»¶çš„DOMæ¸²æŸ“åˆ°ä»»æ„ä½ç½®ï¼Œè§£å†³æ¨¡æ€æ¡†ã€å¼¹çª—ç­‰ç»„ä»¶çš„å±‚çº§å’Œæ ·å¼é—®é¢˜
2. **Suspenseå¼‚æ­¥ç»„ä»¶**ï¼šä¼˜é›…å¤„ç†å¼‚æ­¥ä¾èµ–ï¼Œæä¾›loadingçŠ¶æ€å’Œé”™è¯¯å¤„ç†ï¼Œæ”¹å–„å¼‚æ­¥ç»„ä»¶çš„ç”¨æˆ·ä½“éªŒ
3. **åº”ç”¨åœºæ™¯**ï¼šTeleporté€‚ç”¨äºå…¨å±æ¨¡æ€æ¡†ã€Toasté€šçŸ¥ã€ä¸‹æ‹‰èœå•ï¼›Suspenseé€‚ç”¨äºå¼‚æ­¥è·¯ç”±ã€æ•°æ®é¢„åŠ è½½
4. **ç»„åˆä½¿ç”¨**ï¼šä¸¤è€…å¯ä»¥ç»“åˆä½¿ç”¨ï¼Œæ„å»ºæ›´å¤æ‚çš„å¼‚æ­¥UIæ¨¡å¼

---

## è¯¦ç»†å›ç­”

Vue 3å¼•å…¥äº†Teleportå’ŒSuspenseä¸¤ä¸ªå†…ç½®ç»„ä»¶ï¼Œå®ƒä»¬è§£å†³äº†Vue 2ä¸­çš„ç—›ç‚¹é—®é¢˜ã€‚ä½œä¸ºä¸€åèµ„æ·±å‰ç«¯å·¥ç¨‹å¸ˆ,æˆ‘å°†æ·±å…¥è®²è§£è¿™ä¸¤ä¸ªç»„ä»¶çš„åŸç†ã€ä½¿ç”¨åœºæ™¯å’Œæœ€ä½³å®è·µã€‚

### ä¸€ã€Teleportï¼ˆä¼ é€é—¨ï¼‰

#### 1. ä¸ºä»€ä¹ˆéœ€è¦Teleport

**Vue 2çš„ç—›ç‚¹åœºæ™¯**ï¼š

```vue
<!-- App.vue -->
<template>
  <div id="app">
    <Header />
    <Main>
      <ProductList>
        <ProductItem>
          <!-- åœ¨æ·±å±‚ç»„ä»¶ä¸­æ¸²æŸ“æ¨¡æ€æ¡† -->
          <Modal v-if="showModal">
            <h2>å•†å“è¯¦æƒ…</h2>
          </Modal>
        </ProductItem>
      </ProductList>
    </Main>
  </div>
</template>

<style>
#app {
  position: relative; /* çˆ¶å…ƒç´ æœ‰å®šä½ */
  overflow: hidden;   /* æˆ–è€…æœ‰overflowé™åˆ¶ */
  z-index: 1;         /* æˆ–è€…z-indexè¾ƒä½ */
}
</style>
```

**é—®é¢˜**ï¼š
1. **æ ·å¼é—®é¢˜**ï¼šModalçš„`position: fixed`ä¼šå—åˆ°çˆ¶å…ƒç´ `transform`ã€`filter`ç­‰CSSå±æ€§å½±å“ï¼Œå¯¼è‡´å®šä½é”™ä¹±
2. **å±‚çº§é—®é¢˜**ï¼šçˆ¶å…ƒç´ çš„`z-index`å¯èƒ½å¯¼è‡´Modalè¢«å…¶ä»–å…ƒç´ é®æŒ¡
3. **overflowé—®é¢˜**ï¼šçˆ¶å…ƒç´ çš„`overflow: hidden`ä¼šè£å‰ªModal

**ä¼ ç»Ÿè§£å†³æ–¹æ¡ˆçš„ç¼ºé™·**ï¼š

```javascript
// æ–¹æ¡ˆ1ï¼šæ‰‹åŠ¨æ“ä½œDOMï¼ˆä¸ä¼˜é›…ï¼Œç ´åå“åº”å¼ï¼‰
mounted() {
  document.body.appendChild(this.$refs.modal.$el)
},
beforeUnmount() {
  document.body.removeChild(this.$refs.modal.$el)
}

// æ–¹æ¡ˆ2ï¼šä½¿ç”¨Portalæ’ä»¶ï¼ˆéœ€è¦é¢å¤–ä¾èµ–ï¼‰
```

#### 2. Teleportæ ¸å¿ƒåŸç†

**Teleportçš„ä½œç”¨**ï¼š
å°†ç»„ä»¶çš„DOMç»“æ„æ¸²æŸ“åˆ°æŒ‡å®šçš„ç›®æ ‡å…ƒç´ ä¸­ï¼Œè€Œä¸æ˜¯å½“å‰ç»„ä»¶çš„ä½ç½®ã€‚

**å…³é”®ç‰¹æ€§**ï¼š
- âœ… **é€»è¾‘å±äºå½“å‰ç»„ä»¶**ï¼šæ•°æ®ã€äº‹ä»¶ã€ç”Ÿå‘½å‘¨æœŸéƒ½åœ¨åŸç»„ä»¶ä¸­
- âœ… **DOMæ¸²æŸ“åˆ°åˆ«å¤„**ï¼šå®é™…çš„DOMèŠ‚ç‚¹æŒ‚è½½åˆ°æŒ‡å®šä½ç½®
- âœ… **ä¿æŒå“åº”å¼**ï¼šçŠ¶æ€æ›´æ–°æ­£å¸¸è§¦å‘é‡æ¸²æŸ“

**å·¥ä½œåŸç†å›¾**ï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Component Tree (é€»è¾‘å±‚çº§)           â”‚
â”‚                                     â”‚
â”‚  App                                â”‚
â”‚   â””â”€ ProductItem                    â”‚
â”‚       â””â”€ Modal (é€»è¾‘åœ¨è¿™é‡Œ)         â”‚
â”‚           â”œâ”€ props                  â”‚
â”‚           â”œâ”€ events                 â”‚
â”‚           â””â”€ state                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  DOM Tree (æ¸²æŸ“å±‚çº§)                 â”‚
â”‚                                     â”‚
â”‚  <div id="app">                     â”‚
â”‚    <div class="product">            â”‚
â”‚      <!-- Modalä¸åœ¨è¿™é‡Œ -->         â”‚
â”‚    </div>                           â”‚
â”‚  </div>                             â”‚
â”‚  <div id="modal-container">         â”‚
â”‚    <!-- Modalå®é™…æ¸²æŸ“åœ¨è¿™é‡Œ -->     â”‚
â”‚    <div class="modal">...</div>     â”‚
â”‚  </div>                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### 3. åŸºç¡€ä½¿ç”¨

**æœ€ç®€å•çš„ä¾‹å­**ï¼š

```vue
<template>
  <div class="product-item">
    <h3>{{ product.name }}</h3>
    <button @click="showModal = true">æŸ¥çœ‹è¯¦æƒ…</button>

    <!-- Teleportåˆ°body -->
    <Teleport to="body">
      <div v-if="showModal" class="modal-overlay" @click="showModal = false">
        <div class="modal-content" @click.stop>
          <h2>{{ product.name }}</h2>
          <p>{{ product.description }}</p>
          <button @click="showModal = false">å…³é—­</button>
        </div>
      </div>
    </Teleport>
  </div>
</template>

<script setup>
import { ref } from 'vue'

const props = defineProps(['product'])
const showModal = ref(false)
</script>

<style scoped>
.modal-overlay {
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: rgba(0, 0, 0, 0.5);
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 1000;
}

.modal-content {
  background: white;
  padding: 24px;
  border-radius: 8px;
  max-width: 500px;
}
</style>
```

**æ¸²æŸ“ç»“æœ**ï¼š

```html
<div id="app">
  <div class="product-item">
    <h3>iPhone 15</h3>
    <button>æŸ¥çœ‹è¯¦æƒ…</button>
    <!-- Modalä¸åœ¨è¿™é‡Œ -->
  </div>
</div>

<!-- Modalå®é™…æ¸²æŸ“åœ¨bodyçš„æœ€å -->
<body>
  <!-- ... å…¶ä»–å†…å®¹ ... -->
  <div class="modal-overlay">
    <div class="modal-content">
      <h2>iPhone 15</h2>
      <p>æœ€æ–°æ¬¾iPhone</p>
      <button>å…³é—­</button>
    </div>
  </div>
</body>
```

#### 4. é«˜çº§ç”¨æ³•

**ï¼ˆ1ï¼‰åŠ¨æ€ç›®æ ‡**

```vue
<script setup>
import { ref } from 'vue'

const target = ref('#modal-container')

function changeTarget() {
  target.value = '#another-container'
}
</script>

<template>
  <Teleport :to="target">
    <div class="modal">å†…å®¹</div>
  </Teleport>

  <button @click="changeTarget">åˆ‡æ¢å®¹å™¨</button>
</template>
```

**ï¼ˆ2ï¼‰ç¦ç”¨Teleport**

```vue
<script setup>
import { ref } from 'vue'

// åœ¨ç§»åŠ¨ç«¯ç¦ç”¨Teleportï¼Œåœ¨æ¡Œé¢ç«¯å¯ç”¨
const isMobile = ref(window.innerWidth < 768)
</script>

<template>
  <!-- disabledä¸ºtrueæ—¶ï¼Œåœ¨åŸä½ç½®æ¸²æŸ“ -->
  <Teleport to="body" :disabled="isMobile">
    <div class="sidebar">ä¾§è¾¹æ </div>
  </Teleport>
</template>
```

**ï¼ˆ3ï¼‰å¤šä¸ªTeleportåˆ°åŒä¸€ç›®æ ‡**

```vue
<!-- ComponentA.vue -->
<Teleport to="#modals">
  <div class="modal-a">Modal A</div>
</Teleport>

<!-- ComponentB.vue -->
<Teleport to="#modals">
  <div class="modal-b">Modal B</div>
</Teleport>

<!-- æ¸²æŸ“ç»“æœ -->
<div id="modals">
  <div class="modal-a">Modal A</div>
  <div class="modal-b">Modal B</div>
</div>
```

#### 5. å®æˆ˜æ¡ˆä¾‹ï¼šå…¨å±€Toasté€šçŸ¥

```vue
<!-- composables/useToast.js -->
<script>
import { ref } from 'vue'

const toasts = ref([])
let id = 0

export function useToast() {
  function show(message, type = 'info', duration = 3000) {
    const toast = {
      id: id++,
      message,
      type,
      visible: true
    }

    toasts.value.push(toast)

    if (duration > 0) {
      setTimeout(() => {
        remove(toast.id)
      }, duration)
    }

    return toast.id
  }

  function remove(toastId) {
    const index = toasts.value.findIndex(t => t.id === toastId)
    if (index > -1) {
      toasts.value.splice(index, 1)
    }
  }

  return {
    toasts,
    show,
    remove,
    success: (msg) => show(msg, 'success'),
    error: (msg) => show(msg, 'error'),
    warning: (msg) => show(msg, 'warning'),
    info: (msg) => show(msg, 'info')
  }
}
</script>

<!-- components/ToastContainer.vue -->
<template>
  <Teleport to="body">
    <div class="toast-container">
      <TransitionGroup name="toast">
        <div
          v-for="toast in toasts"
          :key="toast.id"
          :class="['toast', `toast--${toast.type}`]"
          @click="remove(toast.id)"
        >
          {{ toast.message }}
        </div>
      </TransitionGroup>
    </div>
  </Teleport>
</template>

<script setup>
import { useToast } from '@/composables/useToast'

const { toasts, remove } = useToast()
</script>

<style scoped>
.toast-container {
  position: fixed;
  top: 20px;
  right: 20px;
  z-index: 9999;
  pointer-events: none;
}

.toast {
  margin-bottom: 10px;
  padding: 12px 20px;
  border-radius: 4px;
  background: white;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
  pointer-events: auto;
  cursor: pointer;
  min-width: 200px;
}

.toast--success { border-left: 4px solid #52c41a; }
.toast--error { border-left: 4px solid #ff4d4f; }
.toast--warning { border-left: 4px solid #faad14; }
.toast--info { border-left: 4px solid #1890ff; }

.toast-enter-active,
.toast-leave-active {
  transition: all 0.3s ease;
}

.toast-enter-from {
  opacity: 0;
  transform: translateX(100%);
}

.toast-leave-to {
  opacity: 0;
  transform: translateY(-20px);
}
</style>

<!-- ä½¿ç”¨ -->
<script setup>
import { useToast } from '@/composables/useToast'

const toast = useToast()

function handleSubmit() {
  try {
    // ... æäº¤é€»è¾‘
    toast.success('æäº¤æˆåŠŸï¼')
  } catch (error) {
    toast.error('æäº¤å¤±è´¥ï¼š' + error.message)
  }
}
</script>
```

### äºŒã€Suspenseï¼ˆå¼‚æ­¥ç»„ä»¶æ‚¬å¿µï¼‰

#### 1. ä¸ºä»€ä¹ˆéœ€è¦Suspense

**Vue 2å¤„ç†å¼‚æ­¥ç»„ä»¶çš„ç—›ç‚¹**ï¼š

```vue
<!-- Vue 2 çš„æ–¹å¼ -->
<template>
  <div>
    <div v-if="loading">åŠ è½½ä¸­...</div>
    <div v-else-if="error">åŠ è½½å¤±è´¥: {{ error }}</div>
    <div v-else>
      <UserProfile :user="user" />
      <UserPosts :posts="posts" />
    </div>
  </div>
</template>

<script>
export default {
  data() {
    return {
      loading: true,
      error: null,
      user: null,
      posts: null
    }
  },
  async created() {
    try {
      // å¿…é¡»æ‰‹åŠ¨ç®¡ç†loadingçŠ¶æ€
      this.loading = true
      this.user = await fetchUser()
      this.posts = await fetchPosts()
    } catch (e) {
      this.error = e.message
    } finally {
      this.loading = false
    }
  }
}
</script>
```

**é—®é¢˜**ï¼š
1. **é‡å¤çš„loadingé€»è¾‘**ï¼šæ¯ä¸ªå¼‚æ­¥ç»„ä»¶éƒ½è¦å†™loadingã€errorçŠ¶æ€
2. **éš¾ä»¥ç»„åˆ**ï¼šå¤šä¸ªå¼‚æ­¥ç»„ä»¶çš„loadingçŠ¶æ€éš¾ä»¥ç»Ÿä¸€ç®¡ç†
3. **ä»£ç å†—ä½™**ï¼šå¤§é‡æ ·æ¿ä»£ç 

#### 2. Suspenseæ ¸å¿ƒåŸç†

**Suspenseçš„ä½œç”¨**ï¼š
è‡ªåŠ¨æ£€æµ‹å­ç»„ä»¶æ ‘ä¸­çš„å¼‚æ­¥ä¾èµ–ï¼Œç»Ÿä¸€æ˜¾ç¤ºloadingçŠ¶æ€ï¼Œç­‰å¾…æ‰€æœ‰å¼‚æ­¥æ“ä½œå®Œæˆåå†æ¸²æŸ“å†…å®¹ã€‚

**å…³é”®ç‰¹æ€§**ï¼š
- è‡ªåŠ¨è¿½è¸ªå¼‚æ­¥ç»„ä»¶ï¼ˆä½¿ç”¨`async setup`çš„ç»„ä»¶ï¼‰
- æä¾›`#default`å’Œ`#fallback`ä¸¤ä¸ªæ’æ§½
- æ”¯æŒåµŒå¥—å’Œé”™è¯¯å¤„ç†

**å·¥ä½œæµç¨‹**ï¼š

```
1. Suspenseå¼€å§‹æ¸²æŸ“
2. æ£€æµ‹åˆ°å­ç»„ä»¶æœ‰ async setup
3. ç«‹å³æ˜¾ç¤º #fallback å†…å®¹ï¼ˆloadingï¼‰
4. ç­‰å¾…æ‰€æœ‰å¼‚æ­¥æ“ä½œå®Œæˆ
5. åˆ‡æ¢åˆ° #default å†…å®¹ï¼ˆå®é™…å†…å®¹ï¼‰
6. å¦‚æœæœ‰é”™è¯¯ï¼Œè§¦å‘ onErrorCaptured
```

#### 3. åŸºç¡€ä½¿ç”¨

**æœ€ç®€å•çš„ä¾‹å­**ï¼š

```vue
<!-- AsyncComponent.vue -->
<script setup>
// async setupï¼
const data = await fetch('/api/data').then(r => r.json())
</script>

<template>
  <div>
    <h2>{{ data.title }}</h2>
    <p>{{ data.content }}</p>
  </div>
</template>

<!-- ParentComponent.vue -->
<template>
  <Suspense>
    <!-- å¼‚æ­¥ç»„ä»¶ -->
    <template #default>
      <AsyncComponent />
    </template>

    <!-- loadingçŠ¶æ€ -->
    <template #fallback>
      <div class="loading">åŠ è½½ä¸­...</div>
    </template>
  </Suspense>
</template>
```

#### 4. é«˜çº§ç”¨æ³•

**ï¼ˆ1ï¼‰é”™è¯¯å¤„ç†**

```vue
<script setup>
import { ref, onErrorCaptured } from 'vue'

const error = ref(null)

// æ•è·å­ç»„ä»¶çš„é”™è¯¯
onErrorCaptured((err) => {
  error.value = err.message
  return false // é˜»æ­¢é”™è¯¯ç»§ç»­ä¼ æ’­
})
</script>

<template>
  <div v-if="error" class="error">
    åŠ è½½å¤±è´¥: {{ error }}
    <button @click="error = null">é‡è¯•</button>
  </div>

  <Suspense v-else>
    <template #default>
      <AsyncComponent />
    </template>
    <template #fallback>
      <LoadingSpinner />
    </template>
  </Suspense>
</template>
```

**ï¼ˆ2ï¼‰å¤šä¸ªå¼‚æ­¥ç»„ä»¶**

```vue
<template>
  <Suspense>
    <template #default>
      <!-- æ‰€æœ‰å¼‚æ­¥ç»„ä»¶éƒ½åŠ è½½å®Œæˆåæ‰æ˜¾ç¤º -->
      <UserProfile />  <!-- async setup -->
      <UserPosts />    <!-- async setup -->
      <UserFriends />  <!-- async setup -->
    </template>

    <template #fallback>
      <div>åŠ è½½ç”¨æˆ·æ•°æ®ä¸­...</div>
    </template>
  </Suspense>
</template>
```

**ï¼ˆ3ï¼‰åµŒå¥—Suspenseï¼ˆåˆ†é˜¶æ®µåŠ è½½ï¼‰**

```vue
<template>
  <!-- å¤–å±‚ï¼šåŠ è½½ç”¨æˆ·åŸºæœ¬ä¿¡æ¯ -->
  <Suspense>
    <template #default>
      <div>
        <UserHeader />  <!-- å¿«é€ŸåŠ è½½ -->

        <!-- å†…å±‚ï¼šåŠ è½½è¯¦ç»†å†…å®¹ -->
        <Suspense>
          <template #default>
            <UserPosts />     <!-- æ…¢é€ŸåŠ è½½ -->
            <UserComments />  <!-- æ…¢é€ŸåŠ è½½ -->
          </template>
          <template #fallback>
            <div>åŠ è½½è¯¦ç»†å†…å®¹ä¸­...</div>
          </template>
        </Suspense>
      </div>
    </template>

    <template #fallback>
      <div>åŠ è½½ç”¨æˆ·ä¿¡æ¯ä¸­...</div>
    </template>
  </Suspense>
</template>
```

**æ•ˆæœ**ï¼š
```
é˜¶æ®µ1: "åŠ è½½ç”¨æˆ·ä¿¡æ¯ä¸­..."
é˜¶æ®µ2: æ˜¾ç¤ºUserHeader + "åŠ è½½è¯¦ç»†å†…å®¹ä¸­..."
é˜¶æ®µ3: å®Œæ•´å†…å®¹
```

**ï¼ˆ4ï¼‰æ‰‹åŠ¨æ§åˆ¶Suspense**

```vue
<script setup>
import { ref, onMounted } from 'vue'

const isReady = ref(false)

// æ¨¡æ‹Ÿå¼‚æ­¥æ“ä½œ
onMounted(async () => {
  await new Promise(resolve => setTimeout(resolve, 2000))
  isReady.value = true
})
</script>

<template>
  <Suspense>
    <template #default>
      <div v-if="isReady">
        <AsyncContent />
      </div>
    </template>
    <template #fallback>
      <LoadingSpinner />
    </template>
  </Suspense>
</template>
```

#### 5. å®æˆ˜æ¡ˆä¾‹ï¼šç”¨æˆ·è¯¦æƒ…é¡µ

```vue
<!-- pages/UserDetail.vue -->
<script setup>
import { ref, onErrorCaptured } from 'vue'
import { useRoute } from 'vue-router'

const route = useRoute()
const error = ref(null)
const retryKey = ref(0)

onErrorCaptured((err) => {
  error.value = err.message
  return false
})

function retry() {
  error.value = null
  retryKey.value++ // å¼ºåˆ¶é‡æ–°æ¸²æŸ“
}
</script>

<template>
  <div class="user-detail">
    <!-- é”™è¯¯çŠ¶æ€ -->
    <div v-if="error" class="error-container">
      <h2>ğŸ˜• åŠ è½½å¤±è´¥</h2>
      <p>{{ error }}</p>
      <button @click="retry">é‡è¯•</button>
    </div>

    <!-- æ­£å¸¸åŠ è½½ -->
    <Suspense v-else :key="retryKey">
      <template #default>
        <div class="user-content">
          <!-- å¿«é€ŸåŠ è½½ï¼šç”¨æˆ·åŸºæœ¬ä¿¡æ¯ -->
          <Suspense>
            <template #default>
              <UserProfile :user-id="route.params.id" />
            </template>
            <template #fallback>
              <ProfileSkeleton />
            </template>
          </Suspense>

          <!-- å»¶è¿ŸåŠ è½½ï¼šç”¨æˆ·åŠ¨æ€ -->
          <Suspense>
            <template #default>
              <UserTimeline :user-id="route.params.id" />
            </template>
            <template #fallback>
              <TimelineSkeleton />
            </template>
          </Suspense>
        </div>
      </template>

      <template #fallback>
        <PageSkeleton />
      </template>
    </Suspense>
  </div>
</template>

<!-- components/UserProfile.vue -->
<script setup>
import { useFetch } from '@/composables/useFetch'

const props = defineProps(['userId'])

// async setup - ä¼šè¢«Suspenseæ•è·
const { data: user } = await useFetch(`/api/users/${props.userId}`)
</script>

<template>
  <div class="profile-card">
    <img :src="user.avatar" :alt="user.name" />
    <h1>{{ user.name }}</h1>
    <p>{{ user.bio }}</p>
  </div>
</template>

<!-- components/UserTimeline.vue -->
<script setup>
const props = defineProps(['userId'])

// async setup - ä¼šè¢«Suspenseæ•è·
const { data: posts } = await useFetch(`/api/users/${props.userId}/posts`)
</script>

<template>
  <div class="timeline">
    <div v-for="post in posts" :key="post.id" class="post">
      <h3>{{ post.title }}</h3>
      <p>{{ post.content }}</p>
    </div>
  </div>
</template>
```

### ä¸‰ã€Teleport + Suspense ç»„åˆä½¿ç”¨

#### æ¡ˆä¾‹ï¼šå¼‚æ­¥åŠ è½½çš„å…¨å±Modal

```vue
<!-- components/AsyncModal.vue -->
<script setup>
import { ref } from 'vue'

const props = defineProps(['visible', 'dataId'])
const emit = defineEmits(['close'])

// ç»„ä»¶å¯è§æ—¶æ‰åŠ è½½æ•°æ®
const loadData = async () => {
  if (!props.visible) return null
  const response = await fetch(`/api/data/${props.dataId}`)
  return response.json()
}
</script>

<template>
  <Teleport to="body">
    <Transition name="modal">
      <div v-if="visible" class="modal-overlay" @click="emit('close')">
        <div class="modal-content" @click.stop>
          <Suspense>
            <template #default>
              <!-- å¼‚æ­¥åŠ è½½æ•°æ® -->
              <ModalContent :data-id="dataId" />
            </template>

            <template #fallback>
              <div class="loading">
                <Spinner />
                <p>åŠ è½½ä¸­...</p>
              </div>
            </template>
          </Suspense>

          <button @click="emit('close')">å…³é—­</button>
        </div>
      </div>
    </Transition>
  </Teleport>
</template>

<!-- components/ModalContent.vue -->
<script setup>
const props = defineProps(['dataId'])

// async setup
const data = await fetch(`/api/data/${props.dataId}`).then(r => r.json())
</script>

<template>
  <div>
    <h2>{{ data.title }}</h2>
    <p>{{ data.content }}</p>
  </div>
</template>

<style scoped>
.modal-overlay {
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.5);
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 1000;
}

.modal-content {
  background: white;
  padding: 24px;
  border-radius: 8px;
  max-width: 600px;
  max-height: 80vh;
  overflow-y: auto;
}

.modal-enter-active,
.modal-leave-active {
  transition: opacity 0.3s ease;
}

.modal-enter-from,
.modal-leave-to {
  opacity: 0;
}
</style>
```

### å››ã€æœ€ä½³å®è·µä¸æ³¨æ„äº‹é¡¹

#### 1. Teleportæœ€ä½³å®è·µ

```javascript
// âœ… æ¨èï¼šæå‰å‡†å¤‡ç›®æ ‡å®¹å™¨
// index.html
<body>
  <div id="app"></div>
  <div id="modals"></div>  <!-- Teleportç›®æ ‡ -->
  <div id="toasts"></div>
</body>

// âŒ é¿å…ï¼šTeleportåˆ°ä¸å­˜åœ¨çš„å…ƒç´ 
<Teleport to="#non-existent">  <!-- ä¼šæŠ¥é”™ -->
  <div>å†…å®¹</div>
</Teleport>

// âœ… æ¨èï¼šä½¿ç”¨deferæˆ–æ¡ä»¶æ¸²æŸ“
<Teleport to="#modals" :disabled="!isMounted">
  <div>å†…å®¹</div>
</Teleport>
```

#### 2. Suspenseæœ€ä½³å®è·µ

```vue
<!-- âœ… æ¨èï¼šæä¾›æœ‰æ„ä¹‰çš„loadingçŠ¶æ€ -->
<Suspense>
  <template #fallback>
    <ContentSkeleton />  <!-- éª¨æ¶å±ï¼Œè€Œä¸æ˜¯ç®€å•çš„"åŠ è½½ä¸­..." -->
  </template>
</Suspense>

<!-- âœ… æ¨èï¼šé”™è¯¯è¾¹ç•Œ -->
<ErrorBoundary>
  <Suspense>
    <template #default>
      <AsyncComponent />
    </template>
  </Suspense>
</ErrorBoundary>

<!-- âŒ é¿å…ï¼šè¿‡åº¦ä½¿ç”¨async setup -->
<script setup>
// å¦‚æœæ•°æ®ä¸æ˜¯å¿…éœ€çš„ï¼Œä¸è¦ç”¨awaité˜»å¡æ¸²æŸ“
const user = await fetchUser()  // é˜»å¡ï¼

// âœ… æ›´å¥½çš„æ–¹å¼
const { data: user } = useFetch('/api/user')  // ä¸é˜»å¡
</script>
```

#### 3. æ€§èƒ½ä¼˜åŒ–

```vue
<script setup>
import { defineAsyncComponent } from 'vue'

// âœ… æ¨èï¼šç»„ä»¶çº§ä»£ç åˆ†å‰²
const HeavyComponent = defineAsyncComponent(() =>
  import('./HeavyComponent.vue')
)
</script>

<template>
  <Suspense>
    <template #default>
      <HeavyComponent />
    </template>
    <template #fallback>
      <Skeleton />
    </template>
  </Suspense>
</template>
```

### äº”ã€æµè§ˆå™¨å…¼å®¹æ€§

- **Teleport**: Vue 3.0+ï¼Œæ— éœ€polyfillï¼Œæ‰€æœ‰ç°ä»£æµè§ˆå™¨æ”¯æŒ
- **Suspense**: Vue 3.0+ï¼Œå®éªŒæ€§APIï¼ˆVue 3.5å·²ç¨³å®šï¼‰

---

## æ€»ç»“

**Teleportå’ŒSuspenseæ˜¯Vue 3çš„æ€æ‰‹çº§ç‰¹æ€§**ï¼š

**Teleportè§£å†³çš„é—®é¢˜**ï¼š
1. âœ… æ¨¡æ€æ¡†ã€å¼¹çª—çš„æ ·å¼å’Œå±‚çº§é—®é¢˜
2. âœ… å…¨å±€Toastã€Notificationç»„ä»¶
3. âœ… ä¸‹æ‹‰èœå•ã€å·¥å…·æç¤ºçš„å®šä½é—®é¢˜

**Suspenseè§£å†³çš„é—®é¢˜**ï¼š
1. âœ… å¼‚æ­¥ç»„ä»¶çš„loadingçŠ¶æ€ç®¡ç†
2. âœ… ä»£ç åˆ†å‰²å’Œæ‡’åŠ è½½
3. âœ… æ•°æ®é¢„åŠ è½½çš„ç”¨æˆ·ä½“éªŒ

**æ ¸å¿ƒä¼˜åŠ¿**ï¼š
- å‡å°‘æ ·æ¿ä»£ç 
- æ›´ä¼˜é›…çš„APIè®¾è®¡
- æ›´å¥½çš„ç”¨æˆ·ä½“éªŒ
- æ›´å®¹æ˜“ç»´æŠ¤

**ä½¿ç”¨å»ºè®®**ï¼š
- Teleportï¼šæ‰€æœ‰éœ€è¦è„±ç¦»æ–‡æ¡£æµçš„UIç»„ä»¶
- Suspenseï¼šæ‰€æœ‰å¼‚æ­¥æ•°æ®åŠ è½½åœºæ™¯
- ç»„åˆä½¿ç”¨ï¼šæ„å»ºå¤æ‚çš„å¼‚æ­¥UIæ¨¡å¼

é€šè¿‡åˆç†è¿ç”¨è¿™ä¸¤ä¸ªç»„ä»¶ï¼Œå¯ä»¥æ˜¾è‘—æå‡Vueåº”ç”¨çš„å¼€å‘æ•ˆç‡å’Œç”¨æˆ·ä½“éªŒï¼
